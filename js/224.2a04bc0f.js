"use strict";(self["webpackChunkmhealth_proto"]=self["webpackChunkmhealth_proto"]||[]).push([[224],{9224:(e,t,a)=>{a.r(t),a.d(t,{default:()=>Me});var i=a(9835),s=a(6970);function n(e,t,a,n,l,o){const r=(0,i.up)("q-card-section"),d=(0,i.up)("LocalPatients"),u=(0,i.up)("q-card"),m=(0,i.up)("RegisterPatient");return(0,i.wg)(),(0,i.iD)("div",null,[(0,i.Wm)(u,{class:"register-card"},{default:(0,i.w5)((()=>[(0,i.Wm)(r,{class:"card-title"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,s.zw)(e.$t("register.localPatients")),1)])),_:1}),(0,i.Wm)(r,null,{default:(0,i.w5)((()=>[(0,i._)("p",null,(0,s.zw)(e.$t("register.selectLocal")),1),(0,i.Wm)(d,{onSelectPatient:e.selectPatient,localIdSystem:e.localIdSystem,options:{numberOfRandomPatients:10},translations:e.patientListTranslations},null,8,["onSelectPatient","localIdSystem","translations"])])),_:1})])),_:1}),(0,i.Wm)(u,{class:"register-card"},{default:(0,i.w5)((()=>[(0,i.Wm)(r,{class:"card-title"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,s.zw)(e.$t("register.registerPatient")),1)])),_:1}),(0,i.Wm)(r,null,{default:(0,i.w5)((()=>[(0,i.Wm)(m,{patient:e.patient,translations:e.registerPatientTranslations,localIdSystem:e.localIdSystem,onUploadedPatient:e.uploadedPatient},null,8,["patient","translations","localIdSystem","onUploadedPatient"])])),_:1})])),_:1})])}var l=a(1957);const o={key:0},r={class:"title-text"},d={class:"row"},u={class:"col-2"},m={class:"col-4"},p={class:"editable"},h={class:"col-2"},c={class:"col-4"},g={class:"editable"},v={class:"row"},b={class:"col-2"},f={class:"col-4"},y={class:"editable"},w={class:"col-2"},$={class:"col-4"},L={class:"editable"},P={class:"row"},S={class:"col-2"},V={class:"col-4"},_={class:"editable-list"},k={class:"editable"},M={class:"row"},z={class:"col-2"},D={class:"row"},U={class:"col-2"},E={class:"col-4"},N={key:0,class:"col-2"},q={key:1,class:"col-4"},I={class:"non-editable"},W={key:2,class:"col-2"},C={key:3,class:"col-4"},O={class:"button-container"},K={key:0,class:"status-list"};function A(e,t,a,n,A,G){const Z=(0,i.up)("q-input"),T=(0,i.up)("q-popup-edit"),R=(0,i.up)("q-select"),B=(0,i.up)("q-icon"),F=(0,i.up)("q-separator"),j=(0,i.up)("q-btn");return e.translations?((0,i.wg)(),(0,i.iD)("div",o,[(0,i._)("p",r,(0,s.zw)(e.translations.titleText),1),(0,i._)("div",d,[(0,i._)("div",u,[(0,i._)("b",null,(0,s.zw)(e.translations.familyLabel),1)]),(0,i._)("div",m,[(0,i._)("span",p,(0,s.zw)(e.familyName),1),(0,i.Wm)(T,{modelValue:e.familyName,"onUpdate:modelValue":t[0]||(t[0]=t=>e.familyName=t),"auto-save":""},{default:(0,i.w5)((e=>[(0,i.Wm)(Z,{modelValue:e.value,"onUpdate:modelValue":t=>e.value=t,dense:"",autofocus:"",onKeyup:(0,l.D2)(e.set,["enter"])},null,8,["modelValue","onUpdate:modelValue","onKeyup"])])),_:1},8,["modelValue"])]),(0,i._)("div",h,[(0,i._)("b",null,(0,s.zw)(e.translations.genderLabel),1)]),(0,i._)("div",c,[(0,i._)("span",g,(0,s.zw)(e.translations[e.gender+"Gender"]),1),(0,i.Wm)(T,{modelValue:e.gender,"onUpdate:modelValue":t[1]||(t[1]=t=>e.gender=t),"auto-save":""},{default:(0,i.w5)((t=>[(0,i.Wm)(R,{modelValue:t.value,"onUpdate:modelValue":e=>t.value=e,options:e.genderOptions,"option-label":t=>e.translations[t.toLowerCase()+"Gender"]},null,8,["modelValue","onUpdate:modelValue","options","option-label"])])),_:1},8,["modelValue"])])]),(0,i._)("div",v,[(0,i._)("div",b,[(0,i._)("b",null,(0,s.zw)(e.translations.givenLabel),1)]),(0,i._)("div",f,[(0,i._)("span",y,(0,s.zw)(e.givenNames.join(" ")),1),(0,i.Wm)(T,{modelValue:e.givenNames,"onUpdate:modelValue":t[2]||(t[2]=t=>e.givenNames=t),"auto-save":""},{default:(0,i.w5)((e=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(e.value,((t,a)=>((0,i.wg)(),(0,i.iD)("div",{key:"nameInput"+a.toString()},[(0,i.Wm)(Z,{modelValue:e.value[a],"onUpdate:modelValue":t=>e.value[a]=t,dense:"",class:"given-input",autofocus:0===a,onKeyup:(0,l.D2)(e.set,["enter"])},null,8,["modelValue","onUpdate:modelValue","autofocus","onKeyup"]),e.value.length>1?((0,i.wg)(),(0,i.j4)(B,{key:0,name:"fas fa-trash",class:"inline-icon add-delete-icon",onClick:()=>e.value.splice(a,1)},null,8,["onClick"])):(0,i.kq)("",!0),a===e.value.length-1?((0,i.wg)(),(0,i.j4)(B,{key:1,name:"fas fa-plus",class:"inline-icon add-delete-icon",onClick:()=>e.value.push("")},null,8,["onClick"])):(0,i.kq)("",!0)])))),128))])),_:1},8,["modelValue"])]),(0,i._)("div",w,[(0,i._)("b",null,(0,s.zw)(e.translations.birthdateLabel),1)]),(0,i._)("div",$,[(0,i._)("span",L,(0,s.zw)(e.birthdate?e.dateFormatter.format(new Date(e.birthdate)):"-"),1),(0,i.Wm)(T,{modelValue:e.birthdate,"onUpdate:modelValue":t[3]||(t[3]=t=>e.birthdate=t),"auto-save":""},{default:(0,i.w5)((e=>[(0,i.Wm)(Z,{modelValue:e.value,"onUpdate:modelValue":t=>e.value=t,dense:"",type:"date",autofocus:"",onKeyup:(0,l.D2)(e.set,["enter"])},null,8,["modelValue","onUpdate:modelValue","onKeyup"])])),_:1},8,["modelValue"])])]),(0,i.Wm)(F,{size:"0pt"}),(0,i._)("div",P,[(0,i._)("div",S,[(0,i._)("b",null,(0,s.zw)(e.translations.addressLabel),1)]),(0,i._)("div",V,[(0,i._)("ul",_,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(e.addresses,((a,n)=>{var o,r,d;return(0,i.wg)(),(0,i.iD)("li",{key:a.toString().substring(0,20)},[(0,i._)("div",null,[(0,i._)("span",k,[(0,i.Uk)((0,s.zw)(null===(o=a.line)||void 0===o?void 0:o.join(", "))+(0,s.zw)(a.line&&""==a.line[0]?" ":",")+" "+(0,s.zw)(a.postalCode)+" "+(0,s.zw)(a.city)+" "+(0,s.zw)((null===(r=a.state)||void 0===r?void 0:r.length)?"("+a.state+")":"")+" ",1),e.addresses.length>1?((0,i.wg)(),(0,i.j4)(B,{key:0,name:"fas fa-trash",class:"add-delete-icon",onClick:(0,l.iM)((()=>e.addresses.splice(n,1)),["stop"])},null,8,["onClick"])):(0,i.kq)("",!0)]),n===e.addresses.length-1&&(null===(d=a.city)||void 0===d?void 0:d.length)?((0,i.wg)(),(0,i.j4)(B,{key:0,name:"fas fa-plus",class:"add-delete-icon",onClick:t[4]||(t[4]=(0,l.iM)((()=>e.addresses.push({line:[""],city:"",postalCode:""})),["stop"]))})):(0,i.kq)("",!0)]),(0,i.Wm)(T,{modelValue:e.addresses[n],"onUpdate:modelValue":t=>e.addresses[n]=t,"auto-save":""},{default:(0,i.w5)((t=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(t.value.line,((a,s)=>((0,i.wg)(),(0,i.j4)(Z,{key:"line"+s,autofocus:0===s,modelValue:t.value.line[s],"onUpdate:modelValue":e=>t.value.line[s]=e,label:e.translations.streetLabel,dense:"",onKeyup:(0,l.D2)(t.set,["enter"])},null,8,["autofocus","modelValue","onUpdate:modelValue","label","onKeyup"])))),128)),(0,i.Wm)(Z,{modelValue:t.value.postalCode,"onUpdate:modelValue":e=>t.value.postalCode=e,label:e.translations.zipLabel,dense:"",onKeyup:(0,l.D2)(t.set,["enter"])},null,8,["modelValue","onUpdate:modelValue","label","onKeyup"]),(0,i.Wm)(Z,{modelValue:t.value.city,"onUpdate:modelValue":e=>t.value.city=e,label:e.translations.cityLabel,dense:"",onKeyup:(0,l.D2)(t.set,["enter"])},null,8,["modelValue","onUpdate:modelValue","label","onKeyup"]),(0,i.Wm)(Z,{modelValue:t.value.state,"onUpdate:modelValue":e=>t.value.state=e,label:e.translations.stateLabel,dense:"",onKeyup:(0,l.D2)(t.set,["enter"])},null,8,["modelValue","onUpdate:modelValue","label","onKeyup"])])),_:2},1032,["modelValue","onUpdate:modelValue"])])})),128))])])]),(0,i.Wm)(F,{size:"0pt"}),(0,i._)("div",M,[(0,i._)("div",z,[(0,i._)("b",null,(0,s.zw)(e.translations.identifiersLabel),1)])]),(0,i._)("div",D,[(0,i._)("div",U,[(0,i._)("span",null,(0,s.zw)(e.translations.localIdLabel),1)]),(0,i._)("div",E,[(0,i._)("span",{class:(0,s.C_)(e.patient.pat?"non-editable":"editable")},[(0,i.Uk)((0,s.zw)(e.localId)+" ",1),e.patient.pat?(0,i.kq)("",!0):((0,i.wg)(),(0,i.j4)(T,{key:0,modelValue:e.localId,"onUpdate:modelValue":t[5]||(t[5]=t=>e.localId=t),"auto-save":""},{default:(0,i.w5)((e=>[(0,i.Wm)(Z,{modelValue:e.value,"onUpdate:modelValue":t=>e.value=t,dense:"",autofocus:"",onKeyup:(0,l.D2)(e.set,["enter"])},null,8,["modelValue","onUpdate:modelValue","onKeyup"])])),_:1},8,["modelValue"]))],2)]),e.eprSpid?((0,i.wg)(),(0,i.iD)("div",N,[(0,i._)("span",null,(0,s.zw)(e.translations.eprSpidLabel),1)])):(0,i.kq)("",!0),e.eprSpid?((0,i.wg)(),(0,i.iD)("div",q,[(0,i._)("span",I,(0,s.zw)(e.eprSpid),1)])):(0,i.kq)("",!0),e.ahvNumber&&!e.eprSpid?((0,i.wg)(),(0,i.iD)("div",W,[(0,i._)("span",null,(0,s.zw)(e.translations.ahvLabel),1)])):(0,i.kq)("",!0),e.ahvNumber&&!e.eprSpid?((0,i.wg)(),(0,i.iD)("div",C,[(0,i._)("span",{class:(0,s.C_)(e.patient.pat?"non-editable":"editable")},[(0,i.Uk)((0,s.zw)(e.ahvNumber)+" ",1),e.patient.pat?(0,i.kq)("",!0):((0,i.wg)(),(0,i.j4)(T,{key:0,modelValue:e.ahvNumber,"onUpdate:modelValue":t[6]||(t[6]=t=>e.ahvNumber=t),"auto-save":""},{default:(0,i.w5)((e=>[(0,i.Wm)(Z,{modelValue:e.value,"onUpdate:modelValue":t=>e.value=t,dense:"",autofocus:"",onKeyup:(0,l.D2)(e.set,["enter"])},null,8,["modelValue","onUpdate:modelValue","onKeyup"])])),_:1},8,["modelValue"]))],2)])):(0,i.kq)("",!0)]),(0,i.Wm)(F,{size:"0pt"}),(0,i._)("div",O,[(0,i.Wm)(j,{onClick:e.register,label:e.translations.registerButtonLabel,disable:!e.enoughParameters&&!e.patient||e.patient.hasEpr,loading:e.loading},null,8,["onClick","label","disable","loading"]),e.status.length>0?((0,i.wg)(),(0,i.iD)("ul",K,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(e.status,((t,a)=>((0,i.wg)(),(0,i.iD)("li",{key:"msg-"+a,class:(0,s.C_)("status-message"+(a===e.status.length-1&&e.loading?e.error?" error-message":" last-message":""))},(0,s.zw)(t),3)))),128))])):(0,i.kq)("",!0)])])):(0,i.kq)("",!0)}var G=a(4095);const Z=["Daniel","Peter","Thomas","Hans","Christian","Martin","Andreas","Michael","Markus","Marco","David","Patrick","Stefan","Bruno","Urs","Walter","René","Marcel","Roland","Simon"],T=["Maria","Anna","Sandra","Ursula","Elisabeth","Ruth","Monika","Claudia","Nicole","Verena","Barbara","Andrea","Silvia","Daniela","Marie","Christine","Karin","Marianne","Laura","Sarah"],R=["Sasha","Kim","Toni","Kay","Finn","Nikita"],B=["Müller","Meier","Schmid","Keller","Weber","Huber","Schneider","Meyer","Steiner","Fischer","Gerber","Brunner","Baumann","Frei","Zimmermann","Moser","Widmer","Wyss","Graf","Roth"],F=["Dorfstrasse","Hauptstrasse","Bahnhofstrasse","Birkenweg","Schulstrasse","Oberdorfstrasse","Kirchweg","Industriestrasse","Schulhausstrasse","Rosenweg"],j=[{name:"Zürich",zip:"8001",state:"ZH",weight:421},{name:"Basel",zip:"4001",state:"BS",weight:421},{name:"Bern",zip:"3001",state:"BE",weight:421},{name:"Winterthur",zip:"8400",state:"ZH",weight:421},{name:"Luzern",zip:"6001",state:"LU",weight:421},{name:"St. Gallen",zip:"9000",state:"SG",weight:421},{name:"Biel",zip:"2401",state:"BE",weight:421},{name:"Thun",zip:"3600",state:"BE",weight:421},{name:"Köniz",zip:"3098",state:"BE",weight:421},{name:"Freiburg",zip:"1700",state:"FR",weight:421},{name:"Schaffhausen",zip:"8200",state:"SH",weight:421},{name:"Chur",zip:"7000",state:"GB",weight:421},{name:"Uster",zip:"8610",state:"ZH",weight:421},{name:"Emmen",zip:"6032",state:"LU",weight:421},{name:"Zug",zip:"6300",state:"ZG",weight:421},{name:"Dübendorf",zip:"8600",state:"ZH",weight:421},{name:"Kriens",zip:"6010",state:"LU",weight:421}];function H(e){switch(e){case G.PatientAdministrativeGender.MALE:return Z[Math.floor(Math.random()*Z.length)];case G.PatientAdministrativeGender.FEMALE:return T[Math.floor(Math.random()*T.length)];default:return R[Math.floor(Math.random()*R.length)]}}function Q(){return B[Math.floor(Math.random()*B.length)]}function x(){const e=new Date("1920-01-01"),t=new Date("2009-12-31");return new Date(e.getTime()+Math.random()*(t.getTime()-e.getTime())).toISOString().substring(0,10)}function Y(){return j[Math.floor(Math.random()*j.length)]}function J(){return F[Math.floor(Math.random()*F.length)]+" "+Math.ceil(10*Math.random()).toString()}function X(){const e=Math.random();switch(!0){case e<.47:return G.PatientAdministrativeGender.MALE;case e<.95:return G.PatientAdministrativeGender.FEMALE;default:return G.PatientAdministrativeGender.OTHER}}function ee(e){if(9!==e.length)throw new Error("ID must be exactly 9 digits. (is: "+e+")");const t="76",a="13376",i="1";let s=t+a+i+e,n=0;for(let l=s.length-1;l>=0;l--)n+=l%2===0?3*parseInt(s[l]):parseInt(s[l]);return s+=10-n%10,s.toString()}function te(e){const t=new Array;let a=28,i="756.";for(let s=0;s<9;s++){const e=Math.floor(9.999*Math.random());t.push(e),i+=e.toString(),3!==s&&7!==s||(i+="."),a+=e%2===0?3*e:e}return{system:e,value:i+(10-a%10).toString()}}function ae(e,t){var a;const i=Date.now().toString().substring(6,13)+Math.floor(10*Math.random()).toString()+Math.floor(10*Math.random()).toString(),s=X(),n=Y();e.id=e.id||"1",e.identifier&&0!==e.identifier.length||(e.identifier=[{system:t.local}]);const l={resourceType:"Patient",id:i,identifier:[{system:e.identifier[0].system,value:"PAT-"+i}],active:!0,name:[{family:Q(),given:[H(s)]}],gender:s,birthDate:x(),address:[{line:[J()],city:n.name,postalCode:n.zip,state:n.state,country:"Switzerland"}],contained:[e],managingOrganization:{reference:"#"+e.id}};if(null===(a=l.identifier)||void 0===a||a.push(te(t.ahv)),Math.random()>.7){const e=H(s);l.name&&l.name[0]&&l.name[0].given&&e!==l.name[0].given[0]&&l.name[0].given.push()}return l}var ie=a(1834),se=a.n(ie),ne=a(6718);const le=(0,i.aZ)({name:"RegisterPatient",data(){return{givenNames:[""],familyName:"",birthdate:"",localId:"",eprSpid:"",ahvNumber:" ",addresses:[{line:[""],city:"",postalCode:"",state:""}],gender:G.PatientAdministrativeGender.UNKNOWN,genderOptions:new Array,dateFormatter:new Intl.DateTimeFormat(this.$i18n.locale||"de-CH"),status:new Array,loading:!1,error:!1}},props:{patient:{type:Object,required:!1},localIdSystem:{type:Object,required:!0},translations:{type:Object,required:!0}},emits:{"uploaded-patient":e=>void 0!==e},beforeMount(){for(var e in G.PatientAdministrativeGender)e!==G.PatientAdministrativeGender.UNKNOWN&&this.genderOptions.push(e);this.$props.patient&&this.$props.patient.pat&&this.fillDataFromPatient(this.$props.patient.pat)},methods:{fillDataFromPatient(e){var t,a,i,s;this.givenNames=se().evaluate(e,"Patient.name.first().given")||[],this.familyName=se().evaluate(e,"Patient.name.first().family")[0]||"",this.gender=e.gender||G.PatientAdministrativeGender.UNKNOWN,this.birthdate=e.birthDate||"",this.addresses=e.address||[],this.localId=(null===(a=null===(t=e.identifier)||void 0===t?void 0:t.find((e=>e.system===this.$props.localIdSystem.urn)))||void 0===a?void 0:a.value)||"",this.ahvNumber=(null===(s=null===(i=e.identifier)||void 0===i?void 0:i.find((e=>e.system===this.$store.getOids().ahv)))||void 0===s?void 0:s.value)||""},getEprSpid(e){return new Promise(((t,a)=>{setTimeout((()=>{const i=e.substring(4,8)+e.substring(14,15)+e.substring(9,13);try{t({system:this.$store.getOids().eprSpid,value:ee(i)})}catch(s){a(s)}}),1e3+1e3*Math.random())}))},register(){this.loading=!0,this.ahvNumber&&(this.status=[this.$props.translations.queryEprSpidMessage+"("+this.ahvNumber+")"],this.getEprSpid(this.ahvNumber).then((e=>{this.eprSpid=e.value||"?",this.status.push(this.$props.translations.gotEprSpidMessage+this.eprSpid);const t=this.$store.getOrganizationResource();t.id=t.id||"1";const a={resourceType:"Patient",id:this.localId,identifier:[{system:this.$store.getOids().local,value:this.localId},{system:this.$store.getOids().eprSpid,value:this.eprSpid}],active:!0,name:[{family:this.familyName,given:this.givenNames}],gender:this.gender,birthDate:this.birthdate,address:this.addresses,contained:[t],managingOrganization:{reference:"#"+t.id.toString()}};this.status.push(this.$props.translations.registerPatientMessage+this.localId+" / "+this.eprSpid),(0,ne.QO)(a,ne.$o.ADD).then((e=>{var t;e.entry&&e.entry[0]&&e.entry[0].resource&&"ok"===(null===(t=e.entry[0].resource.response)||void 0===t?void 0:t.code)?(this.status.push(this.$props.translations.doneMessage),this.$emit("uploaded-patient",a)):(this.status.push(this.$props.translations.errorMessage),console.log(e))})).catch((e=>{this.status.push(this.$props.translations.errorMessage),console.log(e),this.error=!0})).finally((()=>{this.loading=!1}))})).catch((e=>{console.log("Error getting EPR SPID",e),this.loading=!1})))}},computed:{enoughParameters(){return this.givenNames.length>0&&this.familyName.length>0&&this.localId.length>3&&this.ahvNumber.length>12&&this.birthdate.length>0}},watch:{gender(e){switch(e){case"MALE":case"FEMALE":case"OTHER":case"UNKNOWN":this.gender=G.PatientAdministrativeGender[e]}},patient(e){this.fillDataFromPatient(e.pat)}}});var oe=a(1639),re=a(9843),de=a(3119),ue=a(221),me=a(2857),pe=a(926),he=a(9379),ce=a(9984),ge=a.n(ce);const ve=(0,oe.Z)(le,[["render",A],["__scopeId","data-v-d6128da6"]]),be=ve;ge()(le,"components",{QPopupEdit:re.Z,QInput:de.Z,QSelect:ue.Z,QIcon:me.Z,QSeparator:pe.Z,QBtn:he.Z});const fe={key:0};function ye(e,t,a,s,n,l){const o=(0,i.up)("q-icon"),r=(0,i.up)("q-input"),d=(0,i.up)("q-table");return e.translations?((0,i.wg)(),(0,i.iD)("div",fe,[(0,i.Wm)(d,{title:e.translations.titleLabel,loading:e.loadingData,class:"patients-table",dense:"",filter:e.tableFilter,"filter-method":e.filterTable,"hide-bottom":"",rows:e.loadingData?[]:e.localPatients,pagination:{rowsPerPage:0},onRowClick:e.select,columns:e.tableColumns,"row-key":"localID"},{"top-right":(0,i.w5)((()=>[(0,i.Wm)(r,{borderless:"",dense:"",debounce:"300",modelValue:e.tableFilter,"onUpdate:modelValue":t[0]||(t[0]=t=>e.tableFilter=t),placeholder:e.translations.searchLabel},{append:(0,i.w5)((()=>[(0,i.Wm)(o,{name:"fas fa-search"})])),_:1},8,["modelValue","placeholder"])])),_:1},8,["title","loading","filter","filter-method","rows","onRowClick","columns"])])):(0,i.kq)("",!0)}const we=(0,i.aZ)({name:"LocalPatients",data(){return{localPatients:new Array,loadingData:!1,tableFilter:"",tableColumns:[{name:"family",required:!0,label:this.$props.translations.familyLabel,align:"left",sortable:!0,field:e=>se().evaluate(e.pat,"Patient.name.family")[0]},{name:"given",required:!0,label:this.$props.translations.givenLabel,align:"left",sortable:!0,field:e=>se().evaluate(e.pat,"Patient.name.given")[0]},{name:"gender",required:!1,label:this.$props.translations.genderLabel,align:"left",sortable:!0,field:e=>se().evaluate(e.pat,"Patient.gender")[0].substring(0,1)},{name:"birthdate",required:!0,label:this.$props.translations.birthdateLabel,align:"left",sortable:!0,field:e=>new Date(se().evaluate(e.pat,"Patient.birthDate")[0]).toLocaleDateString()},{name:"hasEpr",required:!1,label:this.$props.translations.hasEPRLabel,align:"left",sortable:!0,field:e=>e.hasEpr?this.$props.translations.yesLabel:this.$props.translations.noLabel},{name:"localID",required:!1,label:this.$props.translations.localPidLabel,align:"left",field:e=>{var t;const a=null===(t=e.pat.identifier)||void 0===t?void 0:t.find((e=>e.system===this.$props.localIdSystem.urn));return a&&a.value?a.value.substring(0,9)+"-"+a.value.substring(9):""}},{name:"ahv",required:!1,label:this.$props.translations.ahvLabel,align:"left",field:e=>{var t;const a=null===(t=e.pat.identifier)||void 0===t?void 0:t.find((e=>e.system===this.$store.getOids().ahv));return a?a.value:""}}]}},props:{localIdSystem:{type:Object,required:!0},translations:{type:Object,required:!0},options:{type:Object,required:!1},patients:{type:Object,required:!1}},emits:{"select-patient":e=>void 0!==e},beforeMount(){var e,t;this.loadingData=!0;let a=this.$props.patients||new Array;if(!this.$props.patients){const i=this.$store.getLocalPatients();if(i.length>0)a=i;else for(let s=0;s<((null===(e=this.$props.options)||void 0===e?void 0:e.numberOfRandomPatients)?null===(t=this.$props.options)||void 0===t?void 0:t.numberOfRandomPatients:10);s++)a.push(ae(this.$store.getOrganizationResource(),this.$store.getOids()))}this.$store.setLocalPatients(a);const i=new Array;a.forEach((e=>{i.push(this.hasEprSpid(e).then((t=>{this.localPatients.push({pat:e,hasEpr:t})})).catch((()=>{this.localPatients.push({pat:e,hasEpr:!1})})))})),Promise.all(i).finally((()=>{this.localPatients.sort(((e,t)=>se().evaluate(e.pat,"Patient.name.family")>se().evaluate(t.pat,"Patient.name.family")?1:-1)),this.loadingData=!1}))},methods:{select(e,t){this.$emit("select-patient",t)},hasEprSpid(e){var t;const a=null===(t=e.identifier)||void 0===t?void 0:t.find((e=>e.system===this.$props.localIdSystem.urn));if(a&&a.system&&a.value){const e=a.system+"|"+a.value;return(0,ne.au)(e,[this.$store.getOids().eprSpid]).then((()=>!0)).catch((()=>(console.log("Error is thrown because patient is not known by EPD Playground."),!1)))}return Promise.resolve(!1)},filterTable(e,t){return t=t.toLowerCase(),e.filter((e=>{var a,i,s,n;let l=e.pat;const o=se().evaluate(l,"Patient.name.given")[0],r=se().evaluate(l,"Patient.name.family")[0],d=se().evaluate(l,"Patient.birthDate")[0],u=(null===(i=null===(a=l.identifier)||void 0===a?void 0:a.find((e=>e.system===this.$props.localIdSystem.urn)))||void 0===i?void 0:i.value)||"",m=(null===(n=null===(s=l.identifier)||void 0===s?void 0:s.find((e=>e.system===this.$store.getOids().ahv)))||void 0===n?void 0:n.value)||"";return o.toLowerCase().includes(t)||r.toLowerCase().includes(t)||d.includes(t)||u.toLowerCase().includes(t)||m.includes(t)}))}},computed:{}});var $e=a(6008);const Le=(0,oe.Z)(we,[["render",ye]]),Pe=Le;ge()(we,"components",{QTable:$e.Z,QInput:de.Z,QIcon:me.Z});const Se=(0,i.aZ)({name:"NewPatient",components:{RegisterPatient:be,LocalPatients:Pe},data(){return{patientListTranslations:{},registerPatientTranslations:{},patient:{hasEpr:!1,pat:void 0},localIdSystem:{urn:"urn:oid:2.16.756.5.30.1.178.1.1",display:"Klinik Höheweg"}}},methods:{selectPatient(e){this.patient=e},uploadedPatient(e){var t,a;if(this.patient&&this.patient.pat){const i=null===(t=this.patient.pat.identifier)||void 0===t?void 0:t.find((e=>e.system===this.$store.getOids().ahv));this.patient.hasEpr=!0,this.patient.pat=e,null===(a=this.patient.pat.identifier)||void 0===a||a.push(i)}}},beforeMount(){this.patientListTranslations={titleLabel:this.$t("register.localPatients"),givenLabel:this.$t("common.givenName"),familyLabel:this.$t("common.familyName"),birthdateLabel:this.$t("common.birthdate"),genderLabel:this.$t("common.gender"),localPidLabel:this.$t("common.localPid"),ahvLabel:this.$t("common.ahv"),hasEPRLabel:this.$t("register.hasEpr"),yesLabel:this.$t("common.yes"),noLabel:this.$t("common.no"),searchLabel:this.$t("common.search")},this.registerPatientTranslations={titleText:this.$t("register.registerLocal"),givenLabel:this.$t("common.givenName"),familyLabel:this.$t("common.familyName"),birthdateLabel:this.$t("common.birthdate"),genderLabel:this.$t("common.gender"),localPidLabel:this.$t("common.localPid"),yesLabel:this.$t("common.yes"),noLabel:this.$t("common.no"),searchLabel:this.$t("common.search"),addressLabel:this.$t("common.address"),streetLabel:this.$t("patients.streetLabel"),cityLabel:this.$t("patients.cityLabel"),zipLabel:this.$t("patients.zipLabel"),stateLabel:this.$t("common.canton"),maleGender:this.$t("common.maleGender"),femaleGender:this.$t("common.femaleGender"),otherGender:this.$t("common.otherGender"),unknownGender:this.$t("common.unknownGender"),identifiersLabel:this.$t("common.identifier"),localIdLabel:this.$t("common.localPid"),eprSpidLabel:this.$t("common.eprSpid"),ahvLabel:this.$t("common.ahv"),registerButtonLabel:this.$t("register.registerPatient"),queryEprSpidMessage:this.$t("register.queryEprSpid"),gotEprSpidMessage:this.$t("register.gotEprSpid"),registerPatientMessage:this.$t("register.registering"),doneMessage:this.$t("register.doneRegistering"),errorMessage:this.$t("register.errorRegistering")}}});var Ve=a(4458),_e=a(3190);const ke=(0,oe.Z)(Se,[["render",n]]),Me=ke;ge()(Se,"components",{QCard:Ve.Z,QCardSection:_e.Z})}}]);