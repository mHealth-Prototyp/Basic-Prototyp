"use strict";(globalThis["webpackChunkmhealth_proto"]=globalThis["webpackChunkmhealth_proto"]||[]).push([[499],{7499:(e,t,a)=>{a.r(t),a.d(t,{default:()=>At});var s=a(9835),l=a(6970);function n(e,t,a,n,i,o){const r=(0,s.up)("q-card-section"),d=(0,s.up)("PatientSearch"),c=(0,s.up)("PatientView"),u=(0,s.up)("q-card"),g=(0,s.up)("q-icon"),y=(0,s.up)("q-card-actions"),p=(0,s.up)("DashboardSelector"),m=(0,s.up)("q-dialog"),h=(0,s.Q2)("close-popup");return(0,s.wg)(),(0,s.iD)(s.HY,null,[(0,s.Wm)(u,{class:"patients-card"},{default:(0,s.w5)((()=>[(0,s.Wm)(r,{class:"card-title"},{default:(0,s.w5)((()=>[(0,s.Uk)((0,l.zw)(e.$t("patients.title")),1)])),_:1}),(0,s.Wm)(r,null,{default:(0,s.w5)((()=>[e.patient.id?((0,s.wg)(),(0,s.j4)(c,{key:1,languageString:e.lang,patient:e.patient,options:e.patientViewOptions,onEditedPatient:e.onEdit,epdPlaygroundUtils:e.$epdUtils,settings:e.$store.getSettings(),fhirUtils:e.$fhirUtils},null,8,["languageString","patient","options","onEditedPatient","epdPlaygroundUtils","settings","fhirUtils"])):((0,s.wg)(),(0,s.j4)(d,{key:0,onFoundPatient:e.onFoundPatient,localIdSystem:e.localIdSystem,epdPlaygroundUtils:e.$epdUtils},null,8,["onFoundPatient","localIdSystem","epdPlaygroundUtils"]))])),_:1})])),_:1}),(0,s.Wm)(m,{modelValue:e.showAllergyDashboard,"onUpdate:modelValue":t[1]||(t[1]=t=>e.showAllergyDashboard=t)},{default:(0,s.w5)((()=>[(0,s.Wm)(u,{class:"dashboard-popup"},{default:(0,s.w5)((()=>[(0,s.Wm)(y,null,{default:(0,s.w5)((()=>[(0,s.wy)((0,s.Wm)(g,{onClick:t[0]||(t[0]=()=>{e.showAllergyDashboard=!1}),name:"fas fa-times",class:"close-icon",flat:"",round:"",dense:""},null,512),[[h]])])),_:1}),(0,s.Wm)(p,{patient:e.patient},null,8,["patient"])])),_:1})])),_:1},8,["modelValue"])],64)}var i=a(3742);const o={key:1,class:"content"},r={key:0},d={key:1},c=["onClick"],u={key:2},g={key:3};function y(e,t,a,n,i,y){const p=(0,s.up)("q-spinner"),m=(0,s.up)("Dashboard"),h=(0,s.up)("q-btn");return e.loading?((0,s.wg)(),(0,s.j4)(p,{key:0,id:"spinner"})):((0,s.wg)(),(0,s.iD)("div",o,[!e.selectedDataset&&e.datasets.length>0?((0,s.wg)(),(0,s.iD)("p",r,(0,l.zw)(e.$t("dashboard.choseExport")),1)):(0,s.kq)("",!0),e.selectedDataset?(0,s.kq)("",!0):((0,s.wg)(),(0,s.iD)("ul",d,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(e.datasets,(t=>((0,s.wg)(),(0,s.iD)("li",{class:"dataset-links",key:t.id,onClick:a=>e.set(t)},(0,l.zw)(e.getDisplayString(t)),9,c)))),128))])),0===e.datasets.length?((0,s.wg)(),(0,s.iD)("p",u,(0,l.zw)(e.$t("dashboard.noEntries")),1)):(0,s.kq)("",!0),e.selectedDataset&&e.patient.name?((0,s.wg)(),(0,s.iD)("h2",g,(0,l.zw)(e.$t("dashboard.title")+e.getPatientName()),1)):(0,s.kq)("",!0),e.selectedDataset?((0,s.wg)(),(0,s.j4)(m,{key:4,patientData:e.selectedDataset},null,8,["patientData"])):(0,s.kq)("",!0),e.selectedDataset?((0,s.wg)(),(0,s.j4)(h,{key:5,onClick:t[0]||(t[0]=t=>e.selectedDataset=void 0)},{default:(0,s.w5)((()=>[(0,s.Uk)((0,l.zw)(e.$t("common.back")),1)])),_:1})):(0,s.kq)("",!0)]))}var p=a(4095);const m={key:0,class:"full-width row justify-around"},h={key:1,class:"error"};function f(e,t,a,n,i,o){const r=(0,s.up)("TimelineCard"),d=(0,s.up)("AirQualityTimelineCard"),c=(0,s.up)("AllergyCard"),u=(0,s.up)("CalendarCard");return e.error?((0,s.wg)(),(0,s.iD)("p",h,(0,l.zw)(e.$t("dashboard.fileError")),1)):((0,s.wg)(),(0,s.iD)("div",m,[(0,s.Wm)(r,{diary:e.diary,suspAllergies:e.suspectedAllergies,knownAllergies:e.knownAllergies,dayOffset:e.offset},null,8,["diary","suspAllergies","knownAllergies","dayOffset"]),(0,s.Wm)(d,{station:e.station,pollen:e.pollen,dayOffset:e.offset},null,8,["station","pollen","dayOffset"]),(0,s.Wm)(c,{confirmedAllergies:e.knownAllergies,suspectedAllergies:e.suspectedAllergies,entriesPerPage:5},null,8,["confirmedAllergies","suspectedAllergies"]),(0,s.Wm)(u,{diary:e.diary},null,8,["diary"])]))}var w=a(4170);const b=new RegExp(/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i);function D(e=new Date){return new Date(e.getFullYear(),e.getMonth(),e.getDate())}function k(e,t,a=new Date){const s=w.ZP.subtractFromDate(a,{days:t});return e=e.filter((e=>w.ZP.isBetweenDates(e.date,s,a,{onlyDate:!0,inclusiveFrom:!1,inclusiveTo:!0}))),e}function v(e){const t=[];if(e.forEach((e=>{var a;const s=null===(a=e.code.coding)||void 0===a?void 0:a.find((e=>"http://snomed.info/sct"===e.system));if(null===s||void 0===s?void 0:s.code){const e=i.bt.find((e=>e.defaultCoding.code===s.code));e&&t.push(e)}})),0===t.length){const e=i.bt.find((e=>"716186003"===e.defaultCoding.code));e&&t.push(e)}return t}function C(e,t,a){return e.concat(t.filter((t=>-1===e.findIndex((e=>t.defaultCoding.code===e.defaultCoding.code))))).filter((e=>"716186003"!==e.defaultCoding.code)).sort(((e,t)=>e.languageDisplays[a].localeCompare(t.languageDisplays[a])))}function $(e){return b.test(e)}function A(e){var t;let a="";return e&&(null===(t=e.given)||void 0===t||t.forEach((e=>a+=`${e} `)),a+=e.family,a.trimEnd()),a}function _(e){let t;if(e.length>0){if(t=e.find((e=>e.use===p.HumanNameNameUse.OFFICIAL)),t)return t;if(t=e.find((e=>e.use===p.HumanNameNameUse.USUAL)),t)return t;if(t=e.find((e=>e.use===p.HumanNameNameUse.TEMP)),t)return t;if(t=e.find((e=>e.use===p.HumanNameNameUse.ANONYMOUS)),t)return t;if(t=e.find((e=>e.use!==p.HumanNameNameUse.OLD)),t)return t}return t}const x={dateTimeToDate:D,filterByDate:k,CHAllergyIntoleranceToAllergySystemCodeExtension:v,MergeAllergySystemCodeExtension:C,isUUID:$,getFullName:A,selectName:_},S=[{name:"eye",sct:"81745001",image:"eye.json",defaultCoding:{system:"http://snomed.info/sct",code:"81745001",display:"Eye"}},{name:"nose",sct:"45206002",image:"nose.json",defaultCoding:{system:"http://snomed.info/sct",code:"45206002",display:"Nose"}},{name:"mouth",sct:"312533001",image:"throat.json",defaultCoding:{system:"http://snomed.info/sct",code:"312533001",display:"Structure of mouth and/or pharynx"}},{name:"lung",sct:"39607008",image:"lung.json",defaultCoding:{system:"http://snomed.info/sct",code:"39607008",display:"Lung"}},{name:"skin",sct:"39937001",image:"skin.json",defaultCoding:{system:"http://snomed.info/sct",code:"39937001",display:"Skin"}},{name:"gastro",sct:"122865005",image:"digestive.json",defaultCoding:{system:"http://snomed.info/sct",code:"122865005",display:"Gastrointestinal tract"}}];var q=a(5993);const P={class:"allergy-button-list"},O=["onClick"],E={key:0,class:"allergy-button-type"},W={class:"allergy-button-name"},Q={key:0,class:"no-entries"},Z={key:1,class:"pages"},z=["onClick"],I={key:0},U={class:"allergy-button-list"},j=["onClick"],T={class:"allergy-button-type"},L={class:"allergy-button-name"},F={key:0,class:"no-entries"},N={key:1,class:"pages"},V=["onClick"],H={key:0};function M(e,t,a,n,i,o){const r=(0,s.up)("q-icon"),d=(0,s.up)("q-card-section"),c=(0,s.up)("q-tab"),u=(0,s.up)("q-tabs"),g=(0,s.up)("q-card"),y=(0,s.up)("AllergyView"),p=(0,s.up)("q-dialog"),m=(0,s.Q2)("close-popup");return(0,s.wg)(),(0,s.iD)(s.HY,null,[(0,s.Wm)(g,{class:"dashboard-card"},{default:(0,s.w5)((()=>[(0,s.Wm)(d,{class:"card-title"},{default:(0,s.w5)((()=>[(0,s.Wm)(r,{name:"fas fa-stethoscope",class:"big-icon"}),(0,s.Uk)(" "+(0,l.zw)(e.$t("allergy.title")),1)])),_:1}),e.suspectedAllergies?((0,s.wg)(),(0,s.j4)(u,{key:0,modelValue:e.tab,"onUpdate:modelValue":t[0]||(t[0]=t=>e.tab=t)},{default:(0,s.w5)((()=>[(0,s.Wm)(c,{name:"known",label:e.$t(e.smallScreen?"allergy.tabKnownShort":"allergy.tabKnown")},null,8,["label"]),(0,s.Wm)(c,{name:"suspected",label:e.$t(e.smallScreen?"allergy.tabSuspectedShort":"allergy.tabSuspected")},null,8,["label"])])),_:1},8,["modelValue"])):(0,s.kq)("",!0),"known"!==e.tab&&e.suspectedAllergies?(0,s.kq)("",!0):((0,s.wg)(),(0,s.j4)(d,{key:1},{default:(0,s.w5)((()=>[(0,s._)("ul",P,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(e.allergies.known,(t=>((0,s.wg)(),(0,s.iD)("li",{key:t.id,class:"clickable allergy-button",onClick:()=>{e.detailDialog=!0,e.selectedAllergy=t}},[t.type?((0,s.wg)(),(0,s.iD)("p",E,(0,l.zw)(e.$t("common."+t.type)),1)):(0,s.kq)("",!0),(0,s._)("p",W,(0,l.zw)(e.getAllergyName(t)),1)],8,O)))),128))]),0===e.allergies.known.length?((0,s.wg)(),(0,s.iD)("p",Q,(0,l.zw)(e.$t("allergy.noEntries")),1)):(0,s.kq)("",!0),e.pages.known>1?((0,s.wg)(),(0,s.iD)("ul",Z,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(e.pages.known,(t=>((0,s.wg)(),(0,s.iD)("li",{key:"knownpagebutton"+t},[(0,s._)("span",{onClick:()=>e.setAllergyPage(t,"known"),class:(0,l.C_)(t===e.currentPage.known?"clickable current-page":"clickable")},"  "+(0,l.zw)(t)+"  ",11,z),t!==e.pages.known?((0,s.wg)(),(0,s.iD)("span",I,"•")):(0,s.kq)("",!0)])))),128))])):(0,s.kq)("",!0)])),_:1})),"suspected"===e.tab?((0,s.wg)(),(0,s.j4)(d,{key:2},{default:(0,s.w5)((()=>[(0,s._)("ul",U,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(e.allergies.suspected,(t=>((0,s.wg)(),(0,s.iD)("li",{key:t.id,class:"clickable allergy-button",onClick:()=>{e.detailDialog=!0,e.selectedAllergy=t}},[(0,s._)("p",T,(0,l.zw)(e.$t("allergy.suspectedSubtitle")),1),(0,s._)("p",L,(0,l.zw)(e.getAllergyName(t)),1)],8,j)))),128))]),0===e.allergies.suspected.length?((0,s.wg)(),(0,s.iD)("p",F,(0,l.zw)(e.$t("allergy.noEntries")),1)):(0,s.kq)("",!0),e.pages.suspected>1?((0,s.wg)(),(0,s.iD)("ul",N,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(e.pages.suspected,(t=>((0,s.wg)(),(0,s.iD)("li",{key:"knownpagebutton"+t},[(0,s._)("span",{onClick:()=>e.setAllergyPage(t,"suspected"),class:(0,l.C_)(t===e.currentPage.suspected?"clickable current-page":"clickable")},"  "+(0,l.zw)(t)+"  ",11,V),t!==e.pages.suspected?((0,s.wg)(),(0,s.iD)("span",H,"•")):(0,s.kq)("",!0)])))),128))])):(0,s.kq)("",!0)])),_:1})):(0,s.kq)("",!0)])),_:1}),(0,s.Wm)(p,{modelValue:e.detailDialog,"onUpdate:modelValue":t[2]||(t[2]=t=>e.detailDialog=t),class:"dialog"},{default:(0,s.w5)((()=>[(0,s.Wm)(g,{class:"allergy-dialog-card"},{default:(0,s.w5)((()=>[(0,s.Wm)(d,{class:"card-title with-close-icon"},{default:(0,s.w5)((()=>[(0,s.Uk)((0,l.zw)(e.selectedAllergy?e.getAllergyName(e.selectedAllergy):"")+" ",1),(0,s.wy)((0,s.Wm)(r,{onClick:t[1]||(t[1]=()=>{e.detailDialog=!1,e.selectedAllergy=void 0}),name:"fas fa-times",class:"close-icon",flat:"",round:"",dense:""},null,512),[[m]])])),_:1}),(0,s.Wm)(d,null,{default:(0,s.w5)((()=>[(0,s.Wm)(y,{allergyIntolerance:e.selectedAllergy,languageString:e.lang,fhirUtils:e.$fhirUtils,epdPlaygroundUtils:e.$epdUtils,showTitle:!1},null,8,["allergyIntolerance","languageString","fhirUtils","epdPlaygroundUtils"])])),_:1})])),_:1})])),_:1},8,["modelValue"])],64)}const B=(0,s.aZ)({name:"AllergyCard",components:{AllergyView:i.HY},data(){return{lang:this.$i18n.locale.substring(0,2),smallScreen:window.innerWidth<400,allergies:{known:new Array,suspected:new Array},pages:{known:0,suspected:0},currentPage:{known:0,suspected:0},tab:"known",detailDialog:!1,selectedAllergy:void 0}},props:{confirmedAllergies:{type:Object,required:!0},suspectedAllergies:{type:Object,required:!1},entriesPerPage:{type:Number,required:!0}},beforeMount(){var e;this.setAllergyPage(1,"known"),this.$props.suspectedAllergies&&this.setAllergyPage(1,"suspected"),this.pages={known:Math.ceil(this.$props.confirmedAllergies.length/this.$props.entriesPerPage),suspected:Math.ceil(((null===(e=this.$props.suspectedAllergies)||void 0===e?void 0:e.length)||0)/this.$props.entriesPerPage)}},watch:{suspectedAllergies(){this.setAllergyPage(-1,"suspected")},confirmedAllergies(){this.setAllergyPage(-1,"known")}},methods:{getAllergyName(e){var t;const a=null===(t=e.code.coding)||void 0===t?void 0:t.find((e=>e.system&&"http://snomed.info/sct"===e.system));if(a&&a.code){const e=i.bt.find((e=>e.defaultCoding.code===a.code));return(null===e||void 0===e?void 0:e.languageDisplays[this.lang])||this.$t("common.unknown")}return this.$t("common.unknown")},setAllergyPage(e,t){const a="known"===t?this.$props.confirmedAllergies:this.$props.suspectedAllergies||[];this.pages[t]=Math.ceil(a.length/this.$props.entriesPerPage),this.currentPage[t]=-1===e?this.pages[t]:e;const s=(this.currentPage[t]-1)*this.$props.entriesPerPage;this.allergies[t]=a.slice(s,s+this.$props.entriesPerPage)}}});var Y=a(1639),R=a(4458),K=a(3190),G=a(2857),J=a(7817),X=a(900),ee=a(2074),te=a(2146),ae=a(9984),se=a.n(ae);const le=(0,Y.Z)(B,[["render",M]]),ne=le;se()(B,"components",{QCard:R.Z,QCardSection:K.Z,QIcon:G.Z,QTabs:J.Z,QTab:X.Z,QDialog:ee.Z}),se()(B,"directives",{ClosePopup:te.Z});const ie=e=>((0,s.dD)("data-v-7653968d"),e=e(),(0,s.Cn)(),e),oe=["onClick"],re=ie((()=>(0,s._)("hr",{width:"100%"},null,-1))),de={key:0},ce={key:0,class:"row justify-around full-width"},ue=["onClick"],ge=ie((()=>(0,s._)("hr",null,null,-1))),ye={key:0},pe={key:0,class:"row justify-start full-width"},me=["onClick"],he={key:0,class:"no-data-text"},fe={class:"day-entry-list"},we=["onClick"];function be(e,t,a,n,i,o){const r=(0,s.up)("q-icon"),d=(0,s.up)("q-card-section"),c=(0,s.up)("q-card"),u=(0,s.up)("DiaryEntryCard"),g=(0,s.up)("q-dialog"),y=(0,s.Q2)("close-popup");return(0,s.wg)(),(0,s.iD)(s.HY,null,[(0,s.Wm)(c,{class:"calendar-card dashboard-card"},{default:(0,s.w5)((()=>[(0,s.Wm)(d,{class:"card-title"},{default:(0,s.w5)((()=>[(0,s.Wm)(r,{name:"fas fa-calendar",class:"big-icon"}),(0,s.Uk)(" "+(0,l.zw)(e.$t("calendar.title")),1)])),_:1}),(0,s.Wm)(d,{class:"row justify-around"},{default:(0,s.w5)((()=>[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(e.years,(t=>((0,s.wg)(),(0,s.iD)("div",{key:t.year,class:(0,l.C_)("row justify-evenly year-tile"+(t.expanded?" expanded":""))},[(0,s._)("div",{class:"date",onClick:a=>e.toggleExpanded(t,!t.expanded)},[(0,s._)("h1",null,(0,l.zw)(t.year),1),re,t.expanded?(0,s.kq)("",!0):((0,s.wg)(),(0,s.iD)("p",de,(0,l.zw)(t.numberOfEntries+" "+(1===t.numberOfEntries?e.$t("calendar.entryLabel"):e.$t("calendar.entriesLabel"))),1))],8,oe),t.expanded?((0,s.wg)(),(0,s.iD)("div",ce,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(t.months,(a=>((0,s.wg)(),(0,s.iD)("div",{key:t.year+"/"+a.month,class:(0,l.C_)("month-tile"+(a.expanded?" expanded":""))},[(0,s._)("div",{class:"date",onClick:t=>e.toggleExpanded(a,!a.expanded)},[(0,s._)("h1",null,(0,l.zw)(a.expanded||e.$t("common.month"+a.month).length<=4?e.$t("common.month"+a.month):e.$t("common.month"+a.month).substring(0,3)+"."),1),ge,a.expanded?(0,s.kq)("",!0):((0,s.wg)(),(0,s.iD)("p",ye,(0,l.zw)(a.numberOfEntries+" "+(1===a.numberOfEntries?e.$t("calendar.entryLabel"):e.$t("calendar.entriesLabel"))),1))],8,ue),a.expanded?((0,s.wg)(),(0,s.iD)("div",pe,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(e.getDayArray(t.year,a.month),(n=>((0,s.wg)(),(0,s.iD)("div",{key:t.year+"/"+a.month+"/"+n,class:(0,l.C_)("day-entry"+(e.numberOfDayEntries(a.days,Number(n))>0?" with-entries":"")),onClick:()=>e.showDayPopup(a.days.find((e=>e.day.toString()===n)))},(0,l.zw)(n),11,me)))),128))])):(0,s.kq)("",!0)],2)))),128))])):(0,s.kq)("",!0)],2)))),128)),0===e.years.length?((0,s.wg)(),(0,s.iD)("p",he,(0,l.zw)(e.$t("diary.noData")),1)):(0,s.kq)("",!0)])),_:1})])),_:1}),(0,s.Wm)(g,{modelValue:e.dayDialog,"onUpdate:modelValue":t[2]||(t[2]=t=>e.dayDialog=t)},{default:(0,s.w5)((()=>{var a,n,i;return[1===(null===(a=e.selectedDay)||void 0===a?void 0:a.entries.length)?((0,s.wg)(),(0,s.j4)(u,{key:0,entry:null===(n=e.selectedDay)||void 0===n?void 0:n.entries[0],onClose:t[0]||(t[0]=t=>e.dayDialog=!1),onCreatedEntry:()=>{}},null,8,["entry"])):(0,s.kq)("",!0),e.selectedDay&&(null===(i=e.selectedDay)||void 0===i?void 0:i.entries.length)>1?((0,s.wg)(),(0,s.j4)(c,{key:1},{default:(0,s.w5)((()=>[(0,s.Wm)(d,{class:"card-title with-close-icon"},{default:(0,s.w5)((()=>[(0,s.Uk)((0,l.zw)(e.$t("calendar.entriesFrom")+" "+new Intl.DateTimeFormat(e.$i18n.locale,{dateStyle:"long"}).format(e.selectedDay.fullDate))+" ",1),(0,s.wy)((0,s.Wm)(r,{onClick:t[1]||(t[1]=t=>e.dayDialog=!1),name:"fas fa-times",class:"close-icon",flat:"",round:"",dense:""},null,512),[[y]])])),_:1}),(0,s.Wm)(d,null,{default:(0,s.w5)((()=>[(0,s._)("ul",fe,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(e.selectedDay.entries,((t,a)=>((0,s.wg)(),(0,s.iD)("li",{key:"entry"+a,onClick:()=>{e.subDayDialog=!0,e.subDayEntry=t}},(0,l.zw)(e.$t("calendar.entryTimeLabel1")+new Intl.DateTimeFormat(e.$i18n.locale,{timeStyle:"short"}).format(t.date)+e.$t("calendar.entryTimeLabel2")),9,we)))),128))])])),_:1})])),_:1})):(0,s.kq)("",!0)]})),_:1},8,["modelValue"]),(0,s.Wm)(g,{modelValue:e.subDayDialog,"onUpdate:modelValue":t[4]||(t[4]=t=>e.subDayDialog=t)},{default:(0,s.w5)((()=>[(0,s.Wm)(u,{entry:e.subDayEntry,onClose:t[3]||(t[3]=t=>e.subDayDialog=!1)},null,8,["entry"])])),_:1},8,["modelValue"])],64)}const De=e=>((0,s.dD)("data-v-d74b2920"),e=e(),(0,s.Cn)(),e),ke={key:0,class:"row"},ve={class:"col-4"},Ce={class:"form-label"},$e={class:"col-8"},Ae={class:"editable-list"},_e={key:0},xe=De((()=>(0,s._)("hr",null,null,-1))),Se={key:1,class:"row"},qe={class:"col-4"},Pe={class:"form-label"},Oe={class:"col-8"},Ee={class:"display"},We={key:2},Qe={key:3,class:"row"},Ze={class:"col-4"},ze={class:"form-label"},Ie={class:"col-8"},Ue={key:4},je={key:5,class:"row"},Te={class:"col-4"},Le={class:"form-label"},Fe={class:"col-8"},Ne={class:"display-note"};function Ve(e,t,a,n,i,o){const r=(0,s.up)("q-icon"),d=(0,s.up)("q-card-section"),c=(0,s.up)("q-card"),u=(0,s.Q2)("close-popup");return(0,s.wg)(),(0,s.j4)(c,{class:(0,l.C_)((e.dashBoardMode," dashboard-card"))},{default:(0,s.w5)((()=>[(0,s.Wm)(d,{class:(0,l.C_)("card-title"+(e.dashBoardMode?"":" with-close-icon"))},{default:(0,s.w5)((()=>[e.dashBoardMode?((0,s.wg)(),(0,s.j4)(r,{key:0,name:"fas fa-book-medical",class:"big-icon"})):(0,s.kq)("",!0),(0,s.Uk)(" "+(0,l.zw)(e.$t("diary.title")+" "+new Intl.DateTimeFormat(e.$i18n.locale,{dateStyle:"long",timeStyle:"short"}).format(e.date))+" ",1),e.dashBoardMode?(0,s.kq)("",!0):(0,s.wy)(((0,s.wg)(),(0,s.j4)(r,{key:1,onClick:t[0]||(t[0]=t=>e.$emit("close")),name:"fas fa-times",class:"close-icon",flat:"",round:"",dense:""},null,512)),[[u]])])),_:1},8,["class"]),(0,s.Wm)(d,null,{default:(0,s.w5)((()=>[e.symptoms.length>0?((0,s.wg)(),(0,s.iD)("div",ke,[(0,s._)("div",ve,[(0,s._)("span",Ce,(0,l.zw)(e.$t("diary.symptomsLabel")),1)]),(0,s._)("div",$e,[(0,s._)("ul",Ae,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(e.symptoms,((t,a)=>((0,s.wg)(),(0,s.iD)("li",{key:a},[(0,s._)("span",null,(0,l.zw)(e.$t("symptom."+t.location.name))+" ("+(0,l.zw)(e.$t("symptom."+t.intensity))+") ",1)])))),128)),0===e.symptoms.length?((0,s.wg)(),(0,s.iD)("li",_e,[(0,s._)("span",{class:"editable",onClick:t[1]||(t[1]=(...t)=>e.addNewSymptom&&e.addNewSymptom(...t))},(0,l.zw)(e.$t("diary.noSymptoms")),1),(0,s.Wm)(r,{name:"fas fa-plus",class:"inline-icon add-delete-icon",onClick:e.addNewSymptom},null,8,["onClick"])])):(0,s.kq)("",!0)])])])):(0,s.kq)("",!0),xe,e.allergy?((0,s.wg)(),(0,s.iD)("div",Se,[(0,s._)("div",qe,[(0,s._)("span",Pe,(0,l.zw)(e.$t("diary.allergyLabel")),1)]),(0,s._)("div",Oe,[(0,s._)("span",Ee,(0,l.zw)(e.allergy?e.allergy.languageDisplays[e.lang]:""),1)])])):(0,s.kq)("",!0),e.allergy?((0,s.wg)(),(0,s.iD)("hr",We)):(0,s.kq)("",!0),e.medications.length>0?((0,s.wg)(),(0,s.iD)("div",Qe,[(0,s._)("div",Ze,[(0,s._)("span",ze,(0,l.zw)(e.$t("diary.medicationsLabel")),1)]),(0,s._)("div",Ie,[(0,s._)("ul",null,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(e.medications,((t,a)=>((0,s.wg)(),(0,s.iD)("li",{key:a},(0,l.zw)(e.medicationsOptionLabel(t)),1)))),128))])])])):(0,s.kq)("",!0),e.medications.length>0?((0,s.wg)(),(0,s.iD)("hr",Ue)):(0,s.kq)("",!0),e.note&&e.note.length>0?((0,s.wg)(),(0,s.iD)("div",je,[(0,s._)("div",Te,[(0,s._)("span",Le,(0,l.zw)(e.$t("diary.noteLabel")),1)]),(0,s._)("div",Fe,[(0,s._)("p",Ne,(0,l.zw)(e.note),1)])])):(0,s.kq)("",!0)])),_:1})])),_:1},8,["class"])}var He=a(7861);const Me={intensity:q.B.NONE,location:{name:"unknown",sct:"261665006",image:"none.json",defaultCoding:{system:"http://snomed.info/sct",code:"261665006",display:"Unknown (qualifier value)"}}},Be=(0,s.aZ)({name:"DiaryEntryCard",components:{},data(){return{date:this.$today,symptoms:new Array,note:void 0,allergy:void 0,symptomLocations:S,knownAllergyCodes:new Array,availableAllergies:new Array,suspectedAllergies:new Array,allergyCodes:new Array,lang:(0,He.getLangStringFromLocale)(this.$i18n.locale),showSuspectedAllergiesPopup:!1,showPreferredMedicationPopup:!1,medications:new Array}},emits:{close:()=>!0},props:{entry:{type:Object,required:!1},dashBoardMode:{type:Boolean,required:!1}},beforeMount(){},mounted(){this.$props.entry&&Object.assign(this,this.$props.entry)},computed:{disableButton(){var e;return(0===this.symptoms.length||1===this.symptoms.length&&this.symptoms[0]===Me)&&(void 0==this.note||0===(null===(e=this.note)||void 0===e?void 0:e.length))&&void 0==this.allergy}},methods:{medicationsOptionLabel(e){var t,a,s,l;let n=this.$t("common.error");return(null===(t=e.code)||void 0===t?void 0:t._text)?n=null!==(a=(0,p.readI18N)(e.code._text,this.lang))&&void 0!==a?a:n:(null===(s=e.code)||void 0===s?void 0:s.text)&&(n=null!==(l=e.code.text)&&void 0!==l?l:n),n},dateSelectorOptions(e){return e<=`${this.$today.getFullYear()}/${`0${this.$today.getMonth()+1}`.slice(-2)}/${`0${this.$today.getDate()}`.slice(-2)}`}},watch:{}});var Ye=a(1480);const Re=(0,Y.Z)(Be,[["render",Ve],["__scopeId","data-v-d74b2920"]]),Ke=Re;se()(Be,"components",{QCard:R.Z,QCardSection:K.Z,QIcon:G.Z,QRadio:Ye.Z}),se()(Be,"directives",{ClosePopup:te.Z});const Ge=(0,s.aZ)({name:"CalendarCard",components:{DiaryEntryCard:Ke},data(){return{years:new Array,dayDialog:!1,subDayDialog:!1,selectedDay:void 0,subDayEntry:void 0,lang:this.$i18n.locale}},emits:{},props:{diary:{type:Array,required:!0}},mounted(){this.buildDataStructure(this.$props.diary)},methods:{toggleExpanded(e,t){e.expanded=t,!t&&e.hasOwnProperty("months")&&e.months.forEach((e=>{e.expanded&&this.toggleExpanded(e,!1)}))},numberOfDayEntries(e,t){const a=e.findIndex((e=>e.day===t));return-1===a?0:e[a].entries.length},showDayPopup(e){this.selectedDay=e,this.dayDialog=!0},getMonthLength(e,t){return 1===t&&e%4===0&&e%100!==0||e%400===0?29:[31,28,31,30,31,30,31,31,30,31,30,31][t]},getDayOfFirstDay(e,t){const a=new Date(e.toString()+"/"+(t+1).toString()+"/1");return a.getDay()},getDayArray(e,t){const a=this.getDayOfFirstDay(e,t),s=this.getMonthLength(e,t),l=new Array(0===a?6:a-1).map((()=>" "));for(let n=1;n<=s;n++)l.push(n.toString());return l},buildDataStructure(e){this.years=[],e.forEach((e=>{const t=e.date.getFullYear(),a=e.date.getMonth(),s=e.date.getDate(),l={year:t,numberOfEntries:1,expanded:!1,months:[{month:a,numberOfEntries:1,expanded:!1,days:[{day:s,fullDate:new Date(`${t}/${a+1}/${s}`),expanded:!1,entries:[e]}]}]};let n=!1;this.years.forEach((i=>{if(!n&&i.year===t){n=!0;let t=!1;i.months.forEach((n=>{if(!t&&n.month===a){t=!0;let a=!1;n.days.forEach((t=>{a||t.day!==s||(a=!0,t.entries.push(e),n.numberOfEntries++,i.numberOfEntries++)})),a||(n.days.push(l.months[0].days[0]),n.days.sort(((e,t)=>e.day-t.day)),n.numberOfEntries++,i.numberOfEntries++)}})),t||(i.months.push(l.months[0]),i.months.sort(((e,t)=>e.month-t.month)),i.numberOfEntries++)}})),n||(this.years.push(l),this.years.sort(((e,t)=>e.year-t.year)))}))}},watch:{diary(e){this.buildDataStructure(e)}}}),Je=(0,Y.Z)(Ge,[["render",be],["__scopeId","data-v-7653968d"]]),Xe=Je;function et(e,t,a,n,i,o){const r=(0,s.up)("q-icon"),d=(0,s.up)("q-card-section"),c=(0,s.up)("q-select"),u=(0,s.up)("apexchart"),g=(0,s.up)("InformationBanner"),y=(0,s.up)("q-card");return(0,s.wg)(),(0,s.iD)(s.HY,null,[(0,s.Wm)(y,{class:"dashboard-card-wide gt-xs"},{default:(0,s.w5)((()=>[(0,s.Wm)(d,{class:"card-title"},{default:(0,s.w5)((()=>[(0,s.Wm)(r,{name:"fas fa-chart-line",class:"big-icon"}),(0,s.Uk)(" "+(0,l.zw)(e.$t("timeline.title")),1)])),_:1}),(0,s.Wm)(d,null,{default:(0,s.w5)((()=>[(0,s.Wm)(c,{modelValue:e.filter,"onUpdate:modelValue":[t[0]||(t[0]=t=>e.filter=t),t[1]||(t[1]=t=>e.getChartData())],dense:"",multiple:"",options:e.availableAllergies,"option-label":t=>t?t.languageDisplays[e.lang]:e.$t("allergy.noAllergy"),"options-dense":"","use-chips":"","stack-label":"",label:e.$t("timeline.filter")},null,8,["modelValue","options","option-label","label"])])),_:1}),e.series.length>0?((0,s.wg)(),(0,s.j4)(d,{key:0},{default:(0,s.w5)((()=>[(0,s.Wm)(u,{height:"400",type:"line",options:e.chartOptions,series:e.series},null,8,["options","series"])])),_:1})):(0,s.kq)("",!0),0===e.series.length?((0,s.wg)(),(0,s.j4)(d,{key:1},{default:(0,s.w5)((()=>[(0,s.Wm)(g,{text:e.$t("diary.noData")},null,8,["text"])])),_:1})):(0,s.kq)("",!0)])),_:1}),(0,s.Wm)(y,{class:"dashboard-card lt-sm"},{default:(0,s.w5)((()=>[(0,s.Wm)(d,{class:"card-title"},{default:(0,s.w5)((()=>[(0,s.Wm)(r,{name:"fas fa-chart-line",class:"big-icon"}),(0,s.Uk)(" "+(0,l.zw)(e.$t("timeline.title")),1)])),_:1}),(0,s.Wm)(d,null,{default:(0,s.w5)((()=>[(0,s.Wm)(g,{text:e.$t("timeline.noShowText")},null,8,["text"])])),_:1})])),_:1})],64)}se()(Ge,"components",{QCard:R.Z,QCardSection:K.Z,QIcon:G.Z,QDialog:ee.Z}),se()(Ge,"directives",{ClosePopup:te.Z});const tt=(0,s.aZ)({name:"TimelineCard",props:{diary:{type:Array,required:!0},dayOffset:{type:Number,required:!0},knownAllergies:{type:Array,required:!0},suspAllergies:{type:Array,required:!0}},data(){return{lang:(0,He.getLangStringFromLocale)(this.$i18n.locale),filter:new Array,knownAllergyCodes:new Array,suspectedAllergies:new Array,availableAllergies:new Array,chartOptions:{markers:{size:[],strokeColors:"#000",strokeWidth:1,shape:"square"},chart:{id:"symptoms-timeline",type:"line",defaultLocale:(0,He.getLangStringFromLocale)(this.$i18n.locale),locales:this.$chartLocales},colors:["#e6194B","#3cb44b","#ffe119","#4363d8","#f58231","#911eb4","#42d4f4","#f032e6","#bfef45","#fabed4","#469990","#dcbeff","#9A6324","#fffac8","#800000","#aaffc3","#808000","#ffd8b1","#000075","#a9a9a9"],grid:{padding:{left:200}},stroke:{curve:"smooth"},legend:{showForSingleSeries:!0},xaxis:{type:"datetime",labels:{datetimeUTC:!0}},yaxis:{labels:{formatter:e=>{switch(e){case 3:return this.$t("symptom.24484000");case 2:return this.$t("symptom.6736007");case 1:return this.$t("symptom.255604002");case 1.5:return this.$t("timeline.taken");case-1:return this.$t("timeline.notTaken");default:return this.$t("symptom.260413007")}},offsetX:190},min:0,max:3,tickAmount:3,title:{text:this.$t("timeline.yAxis")}}},series:[]}},mounted(){this.availableAllergies=x.MergeAllergySystemCodeExtension(x.CHAllergyIntoleranceToAllergySystemCodeExtension(this.knownAllergies),x.CHAllergyIntoleranceToAllergySystemCodeExtension(this.suspAllergies),this.lang),this.getChartData()},updated(){this.getChartData()},methods:{getChartData(){var e,t,a,s,l,n,i,o;let r={},d={260413007:0,255604002:1,6736007:2,24484e3:3};const c=[];for(let p=0;p<S.length;p++){r[S[p].sct]=p,c[p]={name:this.$t("symptom."+S[p].name),type:"line",data:[]};for(let e=this.dayOffset-1;e>=0;e--)c[p].data.push([w.ZP.subtractFromDate(this.$today,{day:e}).getTime(),0])}let u=x.filterByDate(this.diary,this.dayOffset,this.$today);this.filter.length>0&&(u=u.filter((e=>this.filter.some((t=>{var a;return t.defaultCoding.code===(null===(a=e.allergy)||void 0===a?void 0:a.defaultCoding.code)})))));const g=[];for(const p of u){p.medications&&g.push(...p.medications);const e=this.dayOffset-1-w.ZP.getDateDiff(this.$today,p.date,"days");for(const t of p.symptoms){const a=d[t.intensity];c[r[t.location.sct]].data[e][1]<a&&(c[r[t.location.sct]].data[e][1]=a)}}const y=Array.from(new Set(g.map((e=>{var t,a;return null===(a=null===(t=e.code)||void 0===t?void 0:t.coding)||void 0===a?void 0:a[0].code})))).map((e=>g.find((t=>{var a,s;return(null===(s=null===(a=t.code)||void 0===a?void 0:a.coding)||void 0===s?void 0:s[0].code)===e})))),m=Object.keys(r).length;for(let b=m;b<m+y.length;b++){const i=b-m,o=null===(t=null===(e=y[i])||void 0===e?void 0:e.code)||void 0===t?void 0:t._text,d=null===(l=null===(s=null===(a=y[i])||void 0===a?void 0:a.code)||void 0===s?void 0:s.coding)||void 0===l?void 0:l[0].code;if(o&&d){r[d]=b,c[b]={name:null!==(n=(0,p.readI18N)(o,this.lang))&&void 0!==n?n:b.toString(),type:"scatter",data:[]};for(let e=this.dayOffset-1;e>=0;e--)c[b].data.push([w.ZP.subtractFromDate(this.$today,{day:e}).getTime(),-1])}}for(const p of u)if(p.medications){const e=this.dayOffset-1-w.ZP.getDateDiff(this.$today,p.date,"days");for(const t of p.medications){const a=null===(o=null===(i=t.code)||void 0===i?void 0:i.coding)||void 0===o?void 0:o[0].code;a&&(c[r[a]].data[e][1]=1.5)}}const h=[],f=[];for(const p of c)Math.max(...p.data.map((e=>e[1])))>0&&(h.push(p),"line"===p.type?f.push(0):f.push(5));this.chartOptions.markers&&(this.chartOptions=Object.assign(Object.assign({},this.chartOptions),{markers:Object.assign(Object.assign({},this.chartOptions.markers),{size:f})})),this.series=h}}});var at=a(6384);const st=(0,Y.Z)(tt,[["render",et]]),lt=st;function nt(e,t,a,n,i,o){const r=(0,s.up)("q-icon"),d=(0,s.up)("q-card-section"),c=(0,s.up)("apexchart"),u=(0,s.up)("q-card"),g=(0,s.up)("WarningBanner"),y=(0,s.up)("InformationBanner");return(0,s.wg)(),(0,s.iD)(s.HY,null,[e.station?((0,s.wg)(),(0,s.j4)(u,{key:0,class:"dashboard-card-wide gt-xs"},{default:(0,s.w5)((()=>[(0,s.Wm)(d,{class:"card-title"},{default:(0,s.w5)((()=>[(0,s.Wm)(r,{name:"fas fa-smog",class:"big-icon"}),(0,s.Uk)(" "+(0,l.zw)(e.$t("airQuality.title"))+" "+(0,l.zw)(e.$t("airQuality.in"))+" "+(0,l.zw)(e.station.languageDisplays[e.lang]),1)])),_:1}),(0,s.Wm)(d,null,{default:(0,s.w5)((()=>[(0,s.Wm)(c,{height:"400",type:"bar",options:e.chartOptions,series:e.series},null,8,["options","series"])])),_:1})])),_:1})):(0,s.kq)("",!0),e.station?(0,s.kq)("",!0):((0,s.wg)(),(0,s.j4)(u,{key:1,class:"dashboard-card"},{default:(0,s.w5)((()=>[(0,s.Wm)(d,{class:"card-title"},{default:(0,s.w5)((()=>[(0,s.Wm)(r,{name:"fas fa-smog",class:"big-icon"}),(0,s.Uk)(" "+(0,l.zw)(e.$t("airQuality.title")),1)])),_:1}),(0,s.Wm)(d,null,{default:(0,s.w5)((()=>[(0,s.Wm)(g,{text:e.$t("airQuality.noStation")},null,8,["text"])])),_:1})])),_:1})),(0,s.Wm)(u,{class:"dashboard-card lt-sm"},{default:(0,s.w5)((()=>[(0,s.Wm)(d,{class:"card-title"},{default:(0,s.w5)((()=>[(0,s.Wm)(r,{name:"fas fa-smog",class:"big-icon"}),(0,s.Uk)(" "+(0,l.zw)(e.$t("airQuality.title")),1)])),_:1}),(0,s.Wm)(d,null,{default:(0,s.w5)((()=>[(0,s.Wm)(y,{text:e.$t("airQuality.noShowText")},null,8,["text"])])),_:1})])),_:1})],64)}se()(tt,"components",{QCard:R.Z,QCardSection:K.Z,QIcon:G.Z,QSelect:at.Z});const it=(0,s.aZ)({name:"AirQualityTimelineCard",props:{station:{type:Object,required:!1},pollen:{type:Object,required:!1},dayOffset:{type:Number,required:!0}},data(){return{lang:(0,He.getLangStringFromLocale)(this.$i18n.locale),chartOptions:{annotations:{yaxis:[{y:50,yAxisIndex:2,borderColor:"#0C0",label:{borderColor:"#0C0",text:this.$t("airQuality.pm10")+" "+this.$t("airQuality.dailyLimitValue"),style:{color:"#0C0"}}},{y:120,yAxisIndex:3,borderColor:"#F00",label:{borderColor:"#F00",text:this.$t("airQuality.o3")+" "+this.$t("airQuality.dailyLimitValue"),style:{color:"#F00"}}}]},chart:{id:"air-pollution-timeline",defaultLocale:(0,He.getLangStringFromLocale)(this.$i18n.locale),locales:this.$chartLocales},dataLabels:{enabled:!1},plotOptions:{bar:{columnWidth:"50%"}},xaxis:{type:"datetime"},yaxis:[{min:0,max:150,title:{text:this.$t("airQuality.rainfall")+" ("+this.$t("airQuality.mm")+")",style:{color:"#00F"}}},{min:0,max:0,title:{text:this.$t("pollen.noPollen"),style:{color:"#efc000"}}},{min:0,max:200,title:{text:this.$t("airQuality.pm10")+" ("+this.$t("airQuality.ugm3")+")",style:{color:"#0C0"}}},{min:0,max:250,title:{text:this.$t("airQuality.ozone")+" ("+this.$t("airQuality.ugm3")+")",style:{color:"#F00"}}}]},series:[{name:this.$t("airQuality.rainfall"),data:[],color:"#00F"},{name:this.$t("pollen.noPollen"),data:[],color:"#efc000"},{name:this.$t("airQuality.pm10"),data:[],color:"#0C0"},{name:`${this.$t("airQuality.ozone")} (${this.$t("airQuality.o3")})`,data:[],color:"#F00"}]}},mounted(){this.$nextTick((()=>this.getChartData()))},updated(){this.$nextTick((()=>this.getChartData()))},methods:{getChartData(){var e;if(this.station){const t=w.ZP.subtractFromDate(this.$today,{days:this.dayOffset-1});let a;if(null===(e=this.pollen)||void 0===e?void 0:e.defaultCoding.code){if(a=this.$weatherAPIConsumer.getParameter(this.pollen.defaultCoding.code),null===a||void 0===a?void 0:a.pollen){const e={min:0,max:a.pollen.scale.level_3[1]+1,title:{text:`${a.languageDisplays[this.lang]} (${this.$t("airQuality.ppm")})`,style:{color:"#efc000"}}};if(Array.isArray(this.chartOptions.yaxis)){const s=this.chartOptions.yaxis;s[1]=e,this.chartOptions=Object.assign(Object.assign({},this.chartOptions),{yaxis:s}),this.series[1].name=a.languageDisplays[this.lang],this.series[1].data=this.$weatherAPIConsumer.getValues(this.station.id,a.defaultCoding.code,t,this.$today)}}this.series[0].data=this.$weatherAPIConsumer.getValues(this.station.id,"rainfall",t,this.$today),this.series[2].data=this.$weatherAPIConsumer.getValues(this.station.id,"pm10",t,this.$today),this.series[3].data=this.$weatherAPIConsumer.getValues(this.station.id,"ozone",t,this.$today)}}}}}),ot=(0,Y.Z)(it,[["render",nt]]),rt=ot;se()(it,"components",{QCard:R.Z,QCardSection:K.Z,QIcon:G.Z});const dt=["Bekannte Allergien und Intoleranzen","Allergies et intolérances connues"],ct=["Vermutete Allergien und Intoleranzen","Allergies et intolérances suspectées"],ut=["Tagebucheinträge","Entrées du journal"],gt=["Luftqualitätsdaten","Données sur la qualité de l'air"],yt=["418689008","419263009","256262001","256263006","256266003","256277009"],pt=(0,s.aZ)({name:"DashboardPage",components:{CalendarCard:Xe,TimelineCard:lt,AllergyCard:ne,AirQualityTimelineCard:rt},data(){return{knownAllergies:new Array,suspectedAllergies:new Array,diary:new Array,pollen:void 0,station:void 0,offset:30,error:!1}},props:{patientData:{type:Object,required:!0}},beforeMount(){try{this.diary=this.getResourcesForSection(ut).map((e=>this.observationToDiaryEntry(e))),this.diary.length>0&&(this.offset=this.findOffset(this.diary)),this.knownAllergies=this.getResourcesForSection(dt).map((e=>e)),this.suspectedAllergies=this.getResourcesForSection(ct).map((e=>e)),this.station=this.getLocation()}catch(e){this.error=!0}this.error=this.error||0===this.diary.length&&0===this.knownAllergies.length&&0===this.suspectedAllergies.length,this.knownAllergies.concat(this.suspectedAllergies).forEach((e=>{if(!this.pollen){const t=(0,p.getCode)(e.code,"http://snomed.info/sct");t&&yt.includes(t)&&(this.pollen=x.CHAllergyIntoleranceToAllergySystemCodeExtension([e])[0])}}))},methods:{findEntryByReference(e){var t,a;return null===(a=null===(t=this.patientData.entry)||void 0===t?void 0:t.find((t=>t.fullUrl===e)))||void 0===a?void 0:a.resource},getResourcesForSection(e){var t,a,s,l;const n=new Array,i=null===(a=null===(t=this.patientData.entry)||void 0===t?void 0:t.find((e=>{var t;return"Composition"===(null===(t=e.resource)||void 0===t?void 0:t.resourceType)})))||void 0===a?void 0:a.resource;if(i&&i.section){const t=null===(s=i.section)||void 0===s?void 0:s.find((t=>t.title&&e.includes(t.title)));null===(l=null===t||void 0===t?void 0:t.entry)||void 0===l||l.forEach((e=>{const t=this.findEntryByReference(e.reference||"");t&&n.push(t)}))}return n},observationToDiaryEntry(e){var t;const a=new Array;let s;return null===(t=e.component)||void 0===t||t.map((e=>{const t=S.find((t=>t.sct===(0,p.getCode)(e.code,"http://snomed.info/sct"))),l=(0,p.hasCoding)(e.code,{system:"http://loinc.org",code:"52473-6"});t&&a.push({intensity:(0,p.getCode)(e.valueCodeableConcept,"http://snomed.info/sct")||q.B.NONE,location:t}),l&&e.valueCodeableConcept&&e.valueCodeableConcept.coding&&e.valueCodeableConcept.coding.length>0&&(s=e.valueCodeableConcept.coding[0])})),{date:e.effectiveDateTime?new Date(e.effectiveDateTime):new Date,symptoms:a,note:e.valueString,allergy:s?i.bt.find((e=>e.defaultCoding.code===(null===s||void 0===s?void 0:s.code))):void 0,medications:[]}},getLocation(){var e,t,a;let s="de"===this.$i18n.locale?"PBE":"PLS";const l=this.getResourcesForSection(gt).map((e=>e));if(l&&l[0]){let n=null===(e=l[0].subject)||void 0===e?void 0:e.reference;if(n){const e=null===(t=l[0].contained)||void 0===t?void 0:t.find((e=>"Location"===e.resourceType&&e.id===(null===n||void 0===n?void 0:n.split("#")[1])));if(e){let t=null===(a=e.identifier)||void 0===a?void 0:a.find((e=>"https://www.meteoswiss.admin.ch/services-and-publications/applications/measurement-values-and-measuring-networks.html"===e.system));s=t&&t.value?t.value:s}}}return this.$weatherAPIConsumer.getStation(s)},findOffset(e){let t=Date.now();return e.forEach((e=>{const a=new Date(e.date).getTime();t=a<t?a:t})),Math.ceil((Date.now()-t)/864e5)+3}}}),mt=(0,Y.Z)(pt,[["render",f]]),ht=mt,ft=(0,s.aZ)({name:"DashboardSelector",components:{Dashboard:ht},data(){return{datasets:new Array,selectedDataset:void 0,loading:!0}},props:{patient:{type:Object,required:!0}},beforeMount(){var e;const t=null===(e=this.$props.patient.identifier)||void 0===e?void 0:e.find((e=>e.system===this.$epdUtils.getOids().mpiId));t&&t.system&&t.value?this.$epdUtils.useITI67({status:p.DocumentReferenceStatus.CURRENT,"patient.identifier":t.system+"|"+t.value}).then((e=>{this.datasets=e.filter((e=>this.isDashboardExport(e)))})).catch((e=>{console.error("Could not load Dashboard data",e)})).finally((()=>this.loading=!1)):console.warn("Can not fetch Dashboard data without a MPI ID",this.$props.patient)},methods:{isDashboardExport(e){const t="mHealth Proto Allergy Export";return e.content&&e.content[0]&&e.content[0].attachment&&e.content[0].attachment.title===t},set(e){this.$epdUtils.useITI68(e).then((e=>{this.selectedDataset=JSON.parse(e)})).catch((e=>console.warn("Could not fetch file",e)))},getPatientName(){const e=this.patient.name;if(void 0===e)return"";const t=(0,p.selectName)(e);return t?(0,p.getFullName)(t):""},getDisplayString(e){return e.description||e.date?(e.description?e.description+" (":this.$t("dashboard.fileDate"))+(e.date?new Date(e.date).toLocaleDateString()+(e.description?")":""):""):this.$t("dashboard.unknownFile")}}});var wt=a(3940),bt=a(4455);const Dt=(0,Y.Z)(ft,[["render",y]]),kt=Dt;se()(ft,"components",{QSpinner:wt.Z,QBtn:bt.Z});const vt=(0,s.aZ)({name:"PatientsPage",components:{PatientView:i.CG,PatientSearch:i.sR,DashboardSelector:kt},data(){return{lang:this.$i18n.locale.substring(0,2),patient:{resourceType:"Patient"},showAllergyDashboard:!1,localIdSystem:{urn:this.$store.getOids().local,display:"?"},patientViewOptions:{showEditButton:!0,actionButtons:[{label:"Allergie-Dashboard anzeigen",onClick:this.displayAllergyDashboard},{label:this.$t("patients.newSearch"),onClick:this.resetPatient}]}}},beforeMount(){this.localIdSystem.display=this.$store.getOrganizationResource().name||this.localIdSystem.display},methods:{onEdit(e){console.log("edited pat",e)},onFoundPatient(e){this.patient=e},resetPatient(){this.patient={}},displayAllergyDashboard(){this.showAllergyDashboard=!0}}});var Ct=a(1821);const $t=(0,Y.Z)(vt,[["render",n],["__scopeId","data-v-4fe52598"]]),At=$t;se()(vt,"components",{QCard:R.Z,QCardSection:K.Z,QDialog:ee.Z,QCardActions:Ct.Z,QIcon:G.Z}),se()(vt,"directives",{ClosePopup:te.Z})}}]);