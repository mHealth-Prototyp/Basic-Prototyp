"use strict";(self["webpackChunkmhealth_proto"]=self["webpackChunkmhealth_proto"]||[]).push([[577],{1577:(e,t,a)=>{a.r(t),a.d(t,{default:()=>Tt});var l=a(9835),i=a(6970);function n(e,t,a,n,o,s){const d=(0,l.up)("q-card-section"),r=(0,l.up)("PatientSearch"),c=(0,l.up)("PatientView"),u=(0,l.up)("q-card");return(0,l.wg)(),(0,l.j4)(u,{class:"patients-card"},{default:(0,l.w5)((()=>[(0,l.Wm)(d,{class:"card-title"},{default:(0,l.w5)((()=>[(0,l.Uk)((0,i.zw)(e.$t("patients.title")),1)])),_:1}),(0,l.Wm)(d,null,{default:(0,l.w5)((()=>[e.patient.id?((0,l.wg)(),(0,l.j4)(c,{key:1,patient:e.patient,locale:e.$i18n.locale||"de-CH",options:e.patientViewOptions,onEditedPatient:e.onEdit,translations:e.patientViewComponentTranslations},null,8,["patient","locale","options","onEditedPatient","translations"])):((0,l.wg)(),(0,l.j4)(r,{key:0,onFoundPatient:e.onFoundPatient,localIdSystem:e.localIdSystem,translations:e.patientSearchComponentTranslations},null,8,["onFoundPatient","localIdSystem","translations"]))])),_:1})])),_:1})}var o=a(1957);const s={key:0,class:"patient-view"},d={class:"row"},r={class:"col-2"},c={class:"col-4"},u={class:"col-2"},p={class:"col-4"},m={class:"row"},h={class:"col-2"},g={class:"col-4"},f={class:"col-2"},b={class:"col-4"},y={class:"row"},v={class:"col-2"},w={class:"col-10"},S={class:"editable-list"},L={class:"row"},$={class:"col-2"},k={key:0,class:"row"},D={class:"col-2"},C={class:"col-6"},_={class:"non-editable"},I={key:1,class:"row"},V={class:"col-2"},q={class:"col-6"},P={class:"editable-list"},O={key:2,class:"rows"},T={key:1,class:"upload-feedback"},F={key:0,class:"success"},M={key:1,class:"error"},U={class:"rows"},N={class:"col button-container"},W={key:2},z={key:0,class:"warning"},E={key:1,class:"success"};function j(e,t,a,n,j,B){const x=(0,l.up)("q-input"),Z=(0,l.up)("q-popup-edit"),A=(0,l.up)("q-select"),Q=(0,l.up)("q-icon"),K=(0,l.up)("q-separator"),G=(0,l.up)("DocumentSearch"),R=(0,l.up)("q-btn"),H=(0,l.up)("DocumentUpload"),J=(0,l.up)("q-card"),Y=(0,l.up)("q-dialog");return e.translations?((0,l.wg)(),(0,l.iD)("div",s,[(0,l._)("div",d,[(0,l._)("div",r,[(0,l._)("b",null,(0,i.zw)(e.translations.nameLabel),1)]),(0,l._)("div",c,[(0,l._)("span",{class:(0,i.C_)(e.editMode?"editable":"non-editable")},(0,i.zw)(e.familyName.toUpperCase()),3),e.editMode?((0,l.wg)(),(0,l.j4)(Z,{key:0,modelValue:e.familyName,"onUpdate:modelValue":t[0]||(t[0]=t=>e.familyName=t),"auto-save":""},{default:(0,l.w5)((e=>[(0,l.Wm)(x,{modelValue:e.value,"onUpdate:modelValue":t=>e.value=t,dense:"",autofocus:"",onKeyup:(0,o.D2)(e.set,["enter"])},null,8,["modelValue","onUpdate:modelValue","onKeyup"])])),_:1},8,["modelValue"])):(0,l.kq)("",!0)]),(0,l._)("div",u,[(0,l._)("b",null,(0,i.zw)(e.translations.genderLabel),1)]),(0,l._)("div",p,[(0,l._)("span",{class:(0,i.C_)(e.editMode?"editable":"non-editable")},(0,i.zw)(e.getGenderTranslation(e.gender)),3),e.editMode?((0,l.wg)(),(0,l.j4)(Z,{key:0,modelValue:e.gender,"onUpdate:modelValue":t[1]||(t[1]=t=>e.gender=t),"auto-save":""},{default:(0,l.w5)((t=>[(0,l.Wm)(A,{modelValue:t.value,"onUpdate:modelValue":e=>t.value=e,options:e.genderOptions,"option-label":t=>e.getGenderTranslation(t.toLowerCase())},null,8,["modelValue","onUpdate:modelValue","options","option-label"])])),_:1},8,["modelValue"])):(0,l.kq)("",!0)])]),(0,l._)("div",m,[(0,l._)("div",h,[(0,l._)("b",null,(0,i.zw)(e.translations.givenLabel),1)]),(0,l._)("div",g,[(0,l._)("span",{class:(0,i.C_)(e.editMode?"editable":"non-editable")},(0,i.zw)(e.givenNames.map(((e,t)=>0===t?e.toUpperCase():e)).join(" ")),3),e.editMode?((0,l.wg)(),(0,l.j4)(Z,{key:0,modelValue:e.givenNames,"onUpdate:modelValue":t[2]||(t[2]=t=>e.givenNames=t),"auto-save":""},{default:(0,l.w5)((e=>[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e.value,((t,a)=>((0,l.wg)(),(0,l.iD)("div",{key:"nameInput"+a.toString()},[(0,l.Wm)(x,{modelValue:e.value[a],"onUpdate:modelValue":t=>e.value[a]=t,dense:"",class:"given-input",autofocus:0===a,onKeyup:(0,o.D2)(e.set,["enter"])},null,8,["modelValue","onUpdate:modelValue","autofocus","onKeyup"]),e.value.length>1?((0,l.wg)(),(0,l.j4)(Q,{key:0,name:"fas fa-trash",class:"inline-icon add-delete-icon",onClick:()=>e.value.splice(a,1)},null,8,["onClick"])):(0,l.kq)("",!0),a===e.value.length-1?((0,l.wg)(),(0,l.j4)(Q,{key:1,name:"fas fa-plus",class:"inline-icon add-delete-icon",onClick:()=>e.value.push("")},null,8,["onClick"])):(0,l.kq)("",!0)])))),128))])),_:1},8,["modelValue"])):(0,l.kq)("",!0)]),(0,l._)("div",f,[(0,l._)("b",null,(0,i.zw)(e.translations.birthdateLabel),1)]),(0,l._)("div",b,[(0,l._)("span",{class:(0,i.C_)(e.editMode?"editable":"non-editable")},(0,i.zw)(e.birthdate?e.dateFormatter.format(new Date(e.birthdate)):"-"),3),e.editMode?((0,l.wg)(),(0,l.j4)(Z,{key:0,modelValue:e.birthdate,"onUpdate:modelValue":t[3]||(t[3]=t=>e.birthdate=t),"auto-save":""},{default:(0,l.w5)((e=>[(0,l.Wm)(x,{modelValue:e.value,"onUpdate:modelValue":t=>e.value=t,dense:"",type:"date",autofocus:"",onKeyup:(0,o.D2)(e.set,["enter"])},null,8,["modelValue","onUpdate:modelValue","onKeyup"])])),_:1},8,["modelValue"])):(0,l.kq)("",!0)])]),(0,l.Wm)(K,{size:"0pt"}),(0,l._)("div",y,[(0,l._)("div",v,[(0,l._)("b",null,(0,i.zw)(e.translations.addressLabel),1)]),(0,l._)("div",w,[(0,l._)("ul",S,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e.addresses,((a,n)=>{var s;return(0,l.wg)(),(0,l.iD)("li",{key:a.toString().substring(0,20)},[(0,l._)("div",null,[(0,l._)("span",{class:(0,i.C_)(e.editMode?"editable":"non-editable")},[(0,l.Uk)((0,i.zw)(null===(s=a.line)||void 0===s?void 0:s.join(", "))+(0,i.zw)(a.line&&""==a.line[0]?" ":",")+" "+(0,i.zw)(a.postalCode)+" "+(0,i.zw)(a.city)+" ",1),e.editMode&&e.addresses.length>1?((0,l.wg)(),(0,l.j4)(Q,{key:0,name:"fas fa-trash",class:"add-delete-icon",onClick:(0,o.iM)((()=>e.addresses.splice(n,1)),["stop"])},null,8,["onClick"])):(0,l.kq)("",!0)],2),e.editMode&&n===e.addresses.length-1?((0,l.wg)(),(0,l.j4)(Q,{key:0,name:"fas fa-plus",class:"add-delete-icon",onClick:t[4]||(t[4]=(0,o.iM)((()=>e.addresses.push({line:[""],city:"",postalCode:""})),["stop"]))})):(0,l.kq)("",!0)]),e.editMode?((0,l.wg)(),(0,l.j4)(Z,{key:0,modelValue:e.addresses[n],"onUpdate:modelValue":t=>e.addresses[n]=t,"auto-save":""},{default:(0,l.w5)((t=>[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(t.value.line,((a,i)=>((0,l.wg)(),(0,l.j4)(x,{key:"line"+i,autofocus:0===i,modelValue:t.value.line[i],"onUpdate:modelValue":e=>t.value.line[i]=e,label:e.translations.streetLabel,dense:"",onKeyup:(0,o.D2)(t.set,["enter"])},null,8,["autofocus","modelValue","onUpdate:modelValue","label","onKeyup"])))),128)),(0,l.Wm)(x,{modelValue:t.value.postalCode,"onUpdate:modelValue":e=>t.value.postalCode=e,label:e.translations.zipLabel,dense:"",onKeyup:(0,o.D2)(t.set,["enter"])},null,8,["modelValue","onUpdate:modelValue","label","onKeyup"]),(0,l.Wm)(x,{modelValue:t.value.city,"onUpdate:modelValue":e=>t.value.city=e,label:e.translations.cityLabel,dense:"",onKeyup:(0,o.D2)(t.set,["enter"])},null,8,["modelValue","onUpdate:modelValue","label","onKeyup"])])),_:2},1032,["modelValue","onUpdate:modelValue"])):(0,l.kq)("",!0)])})),128))])])]),(0,l.Wm)(K,{size:"0pt"}),(0,l._)("div",L,[(0,l._)("div",$,[(0,l._)("b",null,(0,i.zw)(e.translations.identifiersLabel),1)])]),e.eprSpid?((0,l.wg)(),(0,l.iD)("div",k,[(0,l._)("div",D,(0,i.zw)(e.translations.eprSpidLabel),1),(0,l._)("div",C,[(0,l._)("span",_,(0,i.zw)(e.eprSpid),1)])])):(0,l.kq)("",!0),e.localIds?((0,l.wg)(),(0,l.iD)("div",I,[(0,l._)("div",V,(0,i.zw)(e.translations.localIdLabel),1),(0,l._)("div",q,[(0,l._)("ul",P,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e.localIds,((a,n)=>((0,l.wg)(),(0,l.iD)("li",{key:n.toString()+a.value,class:"id-list"},[(0,l._)("div",null,[(0,l._)("span",{class:(0,i.C_)(e.editMode?"editable":"non-editable")},[(0,l.Uk)((0,i.zw)(a.value)+" ",1),e.editMode&&e.localIds.length>1?((0,l.wg)(),(0,l.j4)(Q,{key:0,name:"fas fa-trash",class:"add-delete-icon",onClick:()=>e.localIds.splice(n,1)},null,8,["onClick"])):(0,l.kq)("",!0)],2),e.editMode&&n===e.localIds.length-1?((0,l.wg)(),(0,l.j4)(Q,{key:0,name:"fas fa-plus",class:"add-delete-icon",onClick:t[5]||(t[5]=(0,o.iM)((()=>e.localIds.push({system:e.$store.getOids().local,value:""})),["stop"]))})):(0,l.kq)("",!0)]),e.editMode?((0,l.wg)(),(0,l.j4)(Z,{key:0,modelValue:e.localIds[n].value,"onUpdate:modelValue":t=>e.localIds[n].value=t,"auto-save":""},{default:(0,l.w5)((e=>[(0,l.Wm)(x,{modelValue:e.value,"onUpdate:modelValue":t=>e.value=t,dense:"",autofocus:"",onKeyup:(0,o.D2)(e.set,["enter"])},null,8,["modelValue","onUpdate:modelValue","onKeyup"])])),_:2},1032,["modelValue","onUpdate:modelValue"])):(0,l.kq)("",!0)])))),128))])])])):(0,l.kq)("",!0),(0,l.Wm)(K,{size:"0pt"}),e.editMode?(0,l.kq)("",!0):((0,l.wg)(),(0,l.iD)("div",O,[(0,l.Wm)(G,{patient:e.patient,ref:"documentSearch",locale:e.locale,demoMode:!0,addedDocuments:e.uploadedDocuments,onFoundDocument:e.openDocument,translations:e.translations.documentSearchStrings},null,8,["patient","locale","addedDocuments","onFoundDocument","translations"]),e.editMode?(0,l.kq)("",!0):((0,l.wg)(),(0,l.j4)(R,{key:0,label:e.translations.addDocumentButton,onClick:t[6]||(t[6]=()=>e.showAddDocumentPopup=!0),class:"add-document-button",small:""},null,8,["label"])),void 0!=e.uploadSuccess?((0,l.wg)(),(0,l.iD)("div",T,[e.uploadSuccess?((0,l.wg)(),(0,l.iD)("p",F,(0,i.zw)(e.translations.uploadSuccessful),1)):(0,l.kq)("",!0),e.uploadSuccess?(0,l.kq)("",!0):((0,l.wg)(),(0,l.iD)("p",M,(0,i.zw)(e.translations.uploadUnsuccessful),1))])):(0,l.kq)("",!0)])),e.editMode?(0,l.kq)("",!0):((0,l.wg)(),(0,l.j4)(K,{key:3,size:"0pt"})),(0,l._)("div",U,[(0,l._)("div",N,[e.options&&e.options.showEditButton?((0,l.wg)(),(0,l.j4)(R,{key:0,label:e.editMode?e.translations.saveButtonLabel||"OK":e.translations.editButtonLabel||"✎",loading:e.updatingPatient,onClick:e.editPatient},null,8,["label","loading","onClick"])):(0,l.kq)("",!0),e.editMode?((0,l.wg)(),(0,l.j4)(R,{key:1,label:e.translations.cancelButtonLabel||"X",onClick:e.cancelEdit},null,8,["label","onClick"])):(0,l.kq)("",!0),!e.editMode&&e.options?((0,l.wg)(),(0,l.iD)("div",W,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e.options.actionButtons,(t=>((0,l.wg)(),(0,l.j4)(R,{key:t.label,label:t.label,onClick:a=>t.onClick(e.patient)},null,8,["label","onClick"])))),128))])):(0,l.kq)("",!0)]),e.editMode&&e.error?((0,l.wg)(),(0,l.iD)("p",z,(0,i.zw)(e.translations.uploadError),1)):(0,l.kq)("",!0),e.success?((0,l.wg)(),(0,l.iD)("p",E,(0,i.zw)(e.translations.uploadSuccess),1)):(0,l.kq)("",!0)]),(0,l.Wm)(Y,{modelValue:e.showAddDocumentPopup,"onUpdate:modelValue":t[7]||(t[7]=t=>e.showAddDocumentPopup=t),"no-backdrop-dismiss":""},{default:(0,l.w5)((()=>[(0,l.Wm)(J,{class:"upload-card"},{default:(0,l.w5)((()=>[(0,l.Wm)(H,{onUploadResult:e.onUploaded,patient:e.patient,locale:e.locale||"de-CH",localIdSystem:e.localIdSystem,onDone:()=>{e.showAddDocumentPopup=!1},translations:e.translations.documentUploadStrings},null,8,["onUploadResult","patient","locale","localIdSystem","onDone","translations"])])),_:1})])),_:1},8,["modelValue"])])):(0,l.kq)("",!0)}var B=a(4095),x=a(1834),Z=a.n(x),A=a(6718);const Q={key:0,class:"loading"},K={key:0,class:"pulse"},G={key:1,class:"ready"},R={key:2,class:"pulse"},H={key:1},J={key:2,class:"warning"};function Y(e,t,a,n,o,s){const d=(0,l.up)("q-linear-progress"),r=(0,l.up)("q-icon"),c=(0,l.up)("q-input"),u=(0,l.up)("q-table");return(0,l.wg)(),(0,l.iD)("div",null,[e.fetchingMpiID||e.fetchingMetadata?((0,l.wg)(),(0,l.iD)("div",Q,[(0,l.Wm)(d,{value:e.fetchingProgress,class:"q-mt-md"},null,8,["value"]),e.fetchingMpiID?((0,l.wg)(),(0,l.iD)("p",K,(0,i.zw)(e.translations.fetchMpiLabel),1)):(0,l.kq)("",!0),e.mpiID.value?((0,l.wg)(),(0,l.iD)("p",G,(0,i.zw)(e.translations.mpiLabel)+" "+(0,i.zw)(e.mpiID.value),1)):(0,l.kq)("",!0),e.fetchingMetadata?((0,l.wg)(),(0,l.iD)("p",R,(0,i.zw)(e.translations.fetchMetadataLabel),1)):(0,l.kq)("",!0)])):((0,l.wg)(),(0,l.iD)("div",H,[(0,l.Wm)(u,{title:e.translations.titleLabel+e.mpiID.value,dense:"",rows:e.documents,columns:e.tableColumns,filter:e.tableFilter,"filter-method":e.filterTable,pagination:{rowsPerPage:10},onRowClick:e.selectDocument},{"top-right":(0,l.w5)((()=>[(0,l.Wm)(c,{borderless:"",dense:"",debounce:"300",modelValue:e.tableFilter,"onUpdate:modelValue":t[0]||(t[0]=t=>e.tableFilter=t),placeholder:e.translations.searchLabel},{append:(0,l.w5)((()=>[(0,l.Wm)(r,{name:"fas fa-search"})])),_:1},8,["modelValue","placeholder"])])),_:1},8,["title","rows","columns","filter","filter-method","onRowClick"])])),e.fetchingError?((0,l.wg)(),(0,l.iD)("p",J,(0,i.zw)(e.translations.fetchingError),1)):(0,l.kq)("",!0)])}var X=a(2874),ee=a(2082);const te=2e3,ae=(0,l.aZ)({name:"DocumentSearch",data(){return{loadedDocuments:new Array,fetchingMpiID:!1,fetchingMetadata:!1,fetchingError:!1,fetchingProgress:0,dateFormatter:new Intl.DateTimeFormat(this.$props.locale||"de-CH"),mpiID:{},tableFilter:"",tableColumns:[{name:"date",required:!0,label:this.$props.translations.dateLabel,align:"left",field:e=>e.date,format:this.formatDateString,sortable:!0},{name:"description",required:!0,label:this.$props.translations.descriptionLabel,align:"left",field:e=>e.description,format:e=>this.shortenString(e),sortable:!0},{name:"class",required:!1,label:this.$props.translations.classLabel,align:"left",field:e=>e.category&&e.category[0].coding?e.category[0].coding[0]:null,format:e=>{if(e&&e.code){const t=(0,ee.tm)(e.code,(0,X.getLangStringFromLocale)(this.$props.locale||"de-CH"));return"?"===t&&e.display?this.shortenString(e.display):this.shortenString(t)}return"?"},sortable:!0},{name:"type",required:!1,label:this.$props.translations.typeLabel,align:"left",field:e=>e.type&&e.type.coding?e.type.coding[0]:null,format:e=>{if(e&&e.code){const t=(0,ee.Cw)(e.code,(0,X.getLangStringFromLocale)(this.$props.locale||"de-CH"));return"?"===t&&e.display?this.shortenString(e.display):this.shortenString(t)}return"?"},sortable:!0},{name:"sourceType",required:!1,label:this.$props.translations.authorLabel,align:"left",field:e=>{var t,a,l,i;return(null===(a=null===(t=e.context)||void 0===t?void 0:t.facilityType)||void 0===a?void 0:a.coding)?null===(i=null===(l=e.context)||void 0===l?void 0:l.facilityType)||void 0===i?void 0:i.coding[0]:null},format:e=>{if(e&&e.code){const t=(0,ee.Jy)(e.code,(0,X.getLangStringFromLocale)(this.$props.locale||"de-CH"));return"?"===t&&e.display?this.shortenString(e.display):this.shortenString(t)}return"?"},sortable:!0},{name:"filetype",required:!1,label:this.$props.translations.fileTypeLabel,align:"left",field:e=>e.content[0].attachment.contentType,format:e=>e,sortable:!0},{name:"size",required:!1,label:this.$props.translations.fileSizeLabel,align:"left",field:e=>e.content[0].attachment.size,format:e=>(Math.round(e/1.024)/1e3).toString()+" "+(e<1048576?this.$props.translations.kiloByteLabel:this.$props.translations.megaByteLabel),sortable:!0}]}},emits:{"found-document":e=>!(void 0===e||!e.document||!e.metadata)||(console.log("Payload does not fulfill foundDocument event specification, event is not emitted.",e),!1)},props:{patient:{type:Object,required:!0},translations:{type:Object,required:!0},addedDocuments:{type:Object,required:!1},locale:{type:String,required:!1},demoMode:{type:Boolean,required:!1}},mounted(){this.fetchData()},methods:{fetchData(){var e;this.fetchingMpiID=!0,this.fetchingError=!1;let t=null===(e=this.$props.patient.identifier)||void 0===e?void 0:e.find((e=>e.system===this.$store.getOids().local));if(t){const e=this.getIDStringFromIdentifier(t);setTimeout((()=>{this.fetchingProgress=.5,(0,A.au)(e,[this.$store.getOids().mpiId]).then((e=>{var t,a;this.fetchingMpiID=!1,this.fetchingMetadata=!0,this.mpiID=(null===(a=null===(t=e.parameter)||void 0===t?void 0:t.find((e=>"targetIdentifier"===e.name&&e.valueIdentifier)))||void 0===a?void 0:a.valueIdentifier)||{},(0,A.bC)({status:B.DocumentReferenceStatus.CURRENT,"patient.identifier":this.getIDStringFromIdentifier(this.mpiID)}).then((e=>{this.loadedDocuments=e})).catch((e=>{this.fetchingError=!0,console.log("Error fetching metadata",e)})).finally((()=>{setTimeout((()=>{this.fetchingProgress=1,this.fetchingMetadata=!1}),this.$props.demoMode?te:0)}))})).catch((e=>{this.fetchingError=!0,console.log("Error fetching Master Patient Index ID",e)}))}),this.$props.demoMode?te:0)}else console.log("Can not fetch data when patient has no local ID.")},selectDocument(e,t){t.content&&t.content[0]&&t.content[0].attachment&&t.content[0].attachment.url&&(0,A.J6)(t).then((e=>{console.log(t),this.$emit("found-document",{document:e,metadata:t})})).catch((e=>{this.fetchingError=!0,console.log("Error fetching document",e)}))},getIDStringFromIdentifier(e){if(e&&e.system&&e.value)return e.system.toString()+"|"+e.value.toString();throw new Error("Identifier is not wellformed, needs system and value.")},formatDateString(e){return this.dateFormatter.format(new Date(e))},shortenString(e,t){return t=t||window.innerWidth/40,e.substring(0,t-1)+(e.length>t-1?"…":"")},filterTable(e,t){const a=this.$props.locale||"de-CH";return t=t.toLowerCase(),e.filter((e=>{var l,i,n,o;let s="",d="",r="";if(null===(i=null===(l=e.context)||void 0===l?void 0:l.facilityType)||void 0===i?void 0:i.coding){const t=null===(o=null===(n=e.context)||void 0===n?void 0:n.facilityType)||void 0===o?void 0:o.coding[0];if(t&&t.code){const e=(0,ee.Jy)(t.code,(0,X.getLangStringFromLocale)(a));s="?"===e&&t.display?t.display:e}}if(e.category&&e.category[0].coding){const t=e.category[0].coding[0];if(t&&t.code){const e=(0,ee.tm)(t.code,(0,X.getLangStringFromLocale)(a));d="?"===e&&t.display?t.display:e}}if(e.type&&e.type.coding){const t=e.type.coding[0];if(t&&t.code){const e=(0,ee.Cw)(t.code,(0,X.getLangStringFromLocale)(a));r="?"===e&&t.display?t.display:e}}return e.description&&e.description.toLowerCase().includes(t)||e.date&&e.date.toLowerCase().includes(t)||e.content[0].attachment.contentType&&e.content[0].attachment.contentType.toLowerCase().includes(t)||e.date&&this.formatDateString(e.date).toLowerCase().includes(t)||s.toLowerCase().includes(t)||d.toLowerCase().includes(t)||r.toLowerCase().includes(t)}))}},computed:{documents(){const e=this.loadedDocuments;return this.$props.addedDocuments&&this.$props.addedDocuments.forEach((t=>{const a=e.findIndex((e=>e.id===t.id));-1===a?e.push(t):e[a]=t})),e.sort(((e,t)=>e.date?t.date?new Date(t.date).getTime()-new Date(e.date).getTime():1:-1))}}}),le=ae;var ie=a(1639),ne=a(8289),oe=a(6008),se=a(3119),de=a(2857),re=a(9984),ce=a.n(re);const ue=(0,ie.Z)(le,[["render",Y],["__scopeId","data-v-1a971e0d"]]),pe=ue;ce()(le,"components",{QLinearProgress:ne.Z,QTable:oe.Z,QInput:se.Z,QIcon:de.Z});const me=e=>((0,l.dD)("data-v-79630aa4"),e=e(),(0,l.Cn)(),e),he={key:0},ge={class:"document-upload"},fe={class:"explain-text"},be={class:"row"},ye={class:"col"},ve={key:0,class:"col fhir-checkbox"},we={class:"explain-text"},Se={class:"row"},Le={class:"col"},$e={class:"row"},ke={class:"col description"},De={class:"row"},Ce={class:"col"},_e={class:"col"},Ie={class:"row"},Ve={class:"col select-col"},qe={class:"row"},Pe={class:"col select-col"},Oe={key:0,class:"row"},Te={class:"col select-col"},Fe={class:"row"},Me={class:"col select-col"},Ue={class:"row"},Ne={class:"col select-col"},We={class:"row"},ze={class:"col select-col"},Ee={class:"row"},je={class:"col select-col"},Be={class:"button-container"},xe={key:1},Ze=me((()=>(0,l._)("p",null,"Missing translations",-1))),Ae=[Ze];function Qe(e,t,a,n,o,s){const d=(0,l.up)("q-file"),r=(0,l.up)("q-checkbox"),c=(0,l.up)("q-btn"),u=(0,l.up)("q-stepper-navigation"),p=(0,l.up)("q-step"),m=(0,l.up)("q-input"),h=(0,l.up)("q-select"),g=(0,l.up)("q-stepper");return e.translations?((0,l.wg)(),(0,l.iD)("div",he,[(0,l._)("div",ge,[(0,l.Wm)(g,{modelValue:e.step,"onUpdate:modelValue":t[15]||(t[15]=t=>e.step=t),"header-nav":"",ref:"stepper",color:"primary",animated:""},{default:(0,l.w5)((()=>[(0,l.Wm)(p,{name:1,title:e.translations.selectFile},{default:(0,l.w5)((()=>[(0,l._)("p",fe,(0,i.zw)(e.translations.selectFileText),1),(0,l._)("div",be,[(0,l._)("div",ye,[(0,l.Wm)(d,{modelValue:e.file,"onUpdate:modelValue":t[0]||(t[0]=t=>e.file=t),label:e.translations.selectFile,dense:""},null,8,["modelValue","label"])]),e.file&&e.file.name.includes(".json")?((0,l.wg)(),(0,l.iD)("div",ve,[(0,l.Wm)(r,{modelValue:e.isFhir,"onUpdate:modelValue":t[1]||(t[1]=t=>e.isFhir=t),label:e.translations.jsonFhir},null,8,["modelValue","label"])])):(0,l.kq)("",!0)]),(0,l.Wm)(u,null,{default:(0,l.w5)((()=>[(0,l.Wm)(c,{onClick:t[2]||(t[2]=()=>{e.step=2}),color:"primary",label:e.translations.continue,disable:!e.file},null,8,["label","disable"])])),_:1})])),_:1},8,["title"]),(0,l.Wm)(p,{name:2,title:e.translations.titleAndDescription,disable:!e.file},{default:(0,l.w5)((()=>[(0,l._)("p",we,(0,i.zw)(e.translations.descriptionText),1),(0,l._)("div",Se,[(0,l._)("div",Le,[(0,l.Wm)(m,{modelValue:e.title,"onUpdate:modelValue":t[3]||(t[3]=t=>e.title=t),type:"text",dense:"",label:e.translations.titleInputLabel},null,8,["modelValue","label"])])]),(0,l._)("div",$e,[(0,l._)("div",ke,[(0,l.Wm)(m,{modelValue:e.description,"onUpdate:modelValue":t[4]||(t[4]=t=>e.description=t),filled:"",dense:"",type:"textarea",label:e.translations.descriptionInputLabel},null,8,["modelValue","label"])])]),(0,l.Wm)(u,null,{default:(0,l.w5)((()=>[(0,l.Wm)(c,{flat:"",onClick:t[5]||(t[5]=t=>e.step=1),color:"primary",label:e.translations.back},null,8,["label"]),(0,l.Wm)(c,{onClick:t[6]||(t[6]=()=>{e.step=3}),color:"primary",label:e.translations.continue,disable:!e.description||e.description.length<1,class:"q-ml-sm"},null,8,["label","disable"])])),_:1})])),_:1},8,["title","disable"]),(0,l.Wm)(p,{name:3,title:e.translations.metadata,disable:!e.file},{default:(0,l.w5)((()=>[(0,l._)("div",De,[(0,l._)("div",Ce,[(0,l._)("p",null,(0,i.zw)(e.translations.languageText),1)]),(0,l._)("div",_e,[(0,l.Wm)(h,{modelValue:e.language,"onUpdate:modelValue":t[7]||(t[7]=t=>e.language=t),label:e.translations.language,options:e.languageOptions,"option-label":t=>t&&t.label?t.label[e.languageString]:"?","option-value":e=>e&&e.value?e.value:void 0},null,8,["modelValue","label","options","option-label","option-value"])])]),(0,l._)("div",Ie,[(0,l._)("div",Ve,[(0,l._)("p",null,(0,i.zw)(e.translations.fileTypeText),1)])]),(0,l._)("div",qe,[(0,l._)("div",Pe,[(0,l.Wm)(h,{modelValue:e.typeSelect,"onUpdate:modelValue":t[8]||(t[8]=t=>e.typeSelect=t),options:e.typeCodeOptions,dense:"","use-input":"",onFilter:e.filterType,"option-label":t=>null==t?"?":t.languageDisplays[e.languageString],"option-value":e=>null==e?null:e.defaultCoding.code,label:e.translations.typeLabel},null,8,["modelValue","options","onFilter","option-label","option-value","label"])])]),e.typeSelect&&e.classCodeOptions.length>1?((0,l.wg)(),(0,l.iD)("div",Oe,[(0,l._)("div",Te,[(0,l._)("p",null,(0,i.zw)(e.translations.typeNotSufficient),1),(0,l.Wm)(h,{modelValue:e.categorySelect,"onUpdate:modelValue":t[9]||(t[9]=t=>e.categorySelect=t),options:e.classCodeOptions,dense:"","option-label":t=>null==t?"?":t.languageDisplays[e.languageString],"option-value":e=>null==e?null:e.defaultCoding.code,label:e.translations.categoryLabel},null,8,["modelValue","options","option-label","option-value","label"])])])):(0,l.kq)("",!0),(0,l.Wm)(u,null,{default:(0,l.w5)((()=>[(0,l.Wm)(c,{flat:"",onClick:t[10]||(t[10]=t=>e.step=2),color:"primary",label:e.translations.back},null,8,["label"]),(0,l.Wm)(c,{onClick:t[11]||(t[11]=()=>{e.step=4}),color:"primary",label:e.translations.continue,disable:!e.typeSelect,class:"q-ml-sm"},null,8,["label","disable"])])),_:1})])),_:1},8,["title","disable"]),(0,l.Wm)(p,{name:4,title:e.translations.creatingInstitution,disable:!e.typeSelect},{default:(0,l.w5)((()=>[(0,l._)("div",Fe,[(0,l._)("div",Me,[(0,l._)("p",null,(0,i.zw)(e.translations.creatingInstitutionText),1)])]),(0,l._)("div",Ue,[(0,l._)("div",Ne,[(0,l.Wm)(h,{modelValue:e.facility,"onUpdate:modelValue":t[12]||(t[12]=t=>e.facility=t),options:e.facilityOptions,dense:"","use-input":"",onFilter:e.filterFacility,"option-label":t=>null==t?"?":t.languageDisplays[e.languageString],"option-value":e=>null==e?null:e.defaultCoding.code,label:e.translations.institution},null,8,["modelValue","options","onFilter","option-label","option-value","label"])])]),(0,l._)("div",We,[(0,l._)("div",ze,[(0,l._)("p",null,(0,i.zw)(e.translations.specialisationText),1)])]),(0,l._)("div",Ee,[(0,l._)("div",je,[(0,l.Wm)(h,{modelValue:e.practiceSetting,"onUpdate:modelValue":t[13]||(t[13]=t=>e.practiceSetting=t),options:e.practiceSettingOptions,dense:"","use-input":"",onFilter:e.filterPracticeSetting,"option-label":t=>null==t?"?":t.languageDisplays[e.languageString],"option-value":e=>null==e?null:e.defaultCoding.code,label:e.translations.specialisation},null,8,["modelValue","options","onFilter","option-label","option-value","label"])])]),(0,l.Wm)(u,null,{default:(0,l.w5)((()=>[(0,l.Wm)(c,{flat:"",onClick:t[14]||(t[14]=t=>e.step=2),color:"primary",label:e.translations.back,class:"q-ml-sm"},null,8,["label"])])),_:1})])),_:1},8,["title","disable"])])),_:1},8,["modelValue"]),(0,l._)("div",Be,[(0,l.Wm)(c,{id:"cancelButton",onClick:t[16]||(t[16]=()=>e.onDone(!1)),label:e.translations.cancelButtonLabel},null,8,["label"]),(0,l.Wm)(c,{id:"uploadButton",disabled:!e.ready,onClick:e.uploadBinaryDocument,color:e.ready?"primary":void 0,label:e.translations.uploadButtonLabel+e.patientName},null,8,["disabled","onClick","color","label"])])])])):((0,l.wg)(),(0,l.iD)("div",xe,Ae))}function Ke(e,t){return t.find((t=>t.defaultCoding.code===e))}const Ge=(0,l.aZ)({name:"DocumentUpload",data(){return{currentPatient:{},file:void 0,title:"",description:"",language:void 0,languageOptions:ee.rh,date:new Date,isFhir:!1,step:1,categorySelect:void 0,classCodeOptions:[],typeSelect:void 0,typeCodeOptions:[],facility:void 0,facilityOptions:[],practiceSetting:void 0,practiceSettingOptions:[],languageString:(0,X.getLangStringFromLocale)(this.$props.locale)}},props:{translations:{type:Object,required:!0},patient:{type:Object,required:!0},onDone:{type:Function,required:!0},locale:{type:String,required:!0}},emits:{"upload-result":e=>void 0!==e},beforeMount(){this.classCodeOptions=ee.e7,this.classCodeOptions.sort(((e,t)=>this.sortCodeOptions(e,t))),this.typeCodeOptions=ee.Rg,this.typeCodeOptions.sort(((e,t)=>this.sortCodeOptions(e,t))),this.facility=Ke(this.$store.getSettings().facilityType.code||"",ee.u0),this.facilityOptions=ee.u0.sort(((e,t)=>this.sortCodeOptions(e,t))),this.practiceSetting=Ke(this.$store.getSettings().practiceSetting.code||"",ee.LB),this.practiceSettingOptions=ee.LB.sort(((e,t)=>this.sortCodeOptions(e,t))),this.language=this.languageOptions.find((e=>e.value===(0,X.getLangStringFromLocale)(this.$store.getLanguage())))},methods:{uploadBinaryDocument(){var e,t,a;if(!this.categorySelect||!this.typeSelect)return void console.warn("Category or Type is undefined.");const l=this.categorySelect.defaultCoding;l.display=this.categorySelect.languageDisplays[this.languageString];const i=this.typeSelect.defaultCoding;i.display=this.typeSelect.languageDisplays[this.languageString];const n={title:this.title,isFhir:this.isFhir,description:this.description,contentLanguage:(null===(e=this.language)||void 0===e?void 0:e.value)||"",sourceIdentifier:this.$store.getOids().app,categoryCoding:l,typeCoding:i,facilityCoding:null===(t=this.facility)||void 0===t?void 0:t.defaultCoding,practiceSettingCoding:null===(a=this.practiceSetting)||void 0===a?void 0:a.defaultCoding};this.$props.patient&&this.file?(0,ee.eB)(this.$props.patient,this.file,n).then((e=>(0,A.r0)(e))).then((e=>{this.$emit("upload-result",e)})).catch((e=>{this.$emit("upload-result",{type:B.BundleType.TRANSACTION_RESPONSE}),console.warn("failed to upload",e)})):(this.$emit("upload-result",{type:B.BundleType.TRANSACTION_RESPONSE}),console.warn("Can't upload without file or patient."))},findCategoryForType(e){const t=ee.yq.filter((t=>t.possibleTypeCodes.includes(e))).map((e=>e.classCode));return ee.e7.filter((e=>t.includes(e.defaultCoding.code.toString())))},filterType(e,t){""==e&&t((()=>{this.typeCodeOptions=ee.Rg})),e.length>0&&t((()=>{const t=e.toLowerCase();this.typeCodeOptions=ee.Rg.filter((e=>e.languageDisplays[this.languageString].toLowerCase().includes(t)))}))},filterFacility(e,t){""==e&&t((()=>{this.facilityOptions=ee.u0})),e.length>0&&t((()=>{const t=e.toLowerCase();this.facilityOptions=ee.u0.filter((e=>e.languageDisplays[this.languageString].toLowerCase().includes(t)))}))},filterPracticeSetting(e,t){""==e&&t((()=>{this.practiceSettingOptions=ee.LB})),e.length>0&&t((()=>{const t=e.toLowerCase();this.practiceSettingOptions=ee.LB.filter((e=>e.languageDisplays[this.languageString].toLowerCase().includes(t)))}))},sortCodeOptions(e,t){return e.languageDisplays[this.languageString]<t.languageDisplays[this.languageString]?-1:e.languageDisplays[this.languageString]>t.languageDisplays[this.languageString]?1:0}},watch:{file(e){const t=e.name.split(".")[0];this.title=t},typeSelect(e){if(e){const t=this.findCategoryForType(e.defaultCoding.code);1===t.length?(this.categorySelect=t[0],this.classCodeOptions=t):this.classCodeOptions=t}}},computed:{patientName(){if(this.$props.patient.name&&this.$props.patient.name[0]&&this.$props.patient.name[0].given){const e=this.$props.patient.name[0].given[0]||"",t=this.$props.patient.name[0].family||"";return e+" "+t}return""},ready(){return this.description.length>0&&void 0!=this.typeSelect}}});var Re=a(8225),He=a(8335),Je=a(3837),Ye=a(1006),Xe=a(1992),et=a(9379),tt=a(221),at=a(8149);const lt=(0,ie.Z)(Ge,[["render",Qe],["__scopeId","data-v-79630aa4"]]),it=lt;ce()(Ge,"components",{QStepper:Re.Z,QStep:He.Z,QFile:Je.Z,QCheckbox:Ye.Z,QStepperNavigation:Xe.Z,QBtn:et.Z,QInput:se.Z,QSelect:tt.Z,QField:at.Z});const nt=5,ot=(0,l.aZ)({name:"PatientView",components:{DocumentSearch:pe,DocumentUpload:it},data(){return{givenNames:new Array,familyName:"",gender:B.PatientAdministrativeGender.UNKNOWN,birthdate:"",addresses:new Array,eprSpid:"",mpiId:"",localIds:new Array,editMode:!1,showAddDocumentPopup:!1,updatingPatient:!1,historyPatient:{},uploadedDocuments:new Array,dateFormatter:new Intl.DateTimeFormat(this.$i18n.locale),genderOptions:new Array,documentSearchDemoMode:!0,localIdSystem:{urn:this.$store.getOids().local,display:""},error:!1,success:!1,uploadSuccess:void 0}},props:{patient:{type:Object,required:!0},translations:{type:Object,required:!0},options:{type:Object,required:!1},locale:{type:String,required:!1}},emits:{"edited-patient":e=>void 0!==e},beforeMount(){for(var e in B.PatientAdministrativeGender)this.genderOptions.push(e);this.fillDataFromPatient(this.$props.patient),this.localIdSystem.display=this.$store.getOrganizationResource().name||this.localIdSystem.display},methods:{editPatient(){var e;if(this.documentSearchDemoMode=!1,this.editMode){const t=this.$store.getOrganizationResource();t.id=t.id||"1",this.error=!1,this.updatingPatient=!0;const a=this.$props.patient;a.name&&a.name[0]?(a.name[0].family=this.familyName,a.name[0].given=this.givenNames.filter((e=>""!==e))):a.name=[{family:this.familyName,given:this.givenNames}],a.address=this.addresses.filter((e=>""!==e.city&&""!==e.postalCode)),a.gender=this.gender,a.birthDate=this.birthdate;const l=this.$store.getOids(),i=(null===(e=a.identifier)||void 0===e?void 0:e.filter((e=>{e.system!==l.mpiId&&e.system!==l.eprSpid&&(e.system,l.local)})))||[];a.identifier=[{system:l.mpiId,value:this.mpiId},{system:l.eprSpid,value:this.eprSpid}].concat(this.localIds.filter((e=>""!==e.value))).concat(i),a.contained=[t],a.managingOrganization={reference:"#"+t.id},(0,A.QO)(a,A.$o.UPDATE).then((e=>{var t;e.entry&&e.entry[0]&&e.entry[0].resource&&(null===(t=e.entry[0].resource.response)||void 0===t?void 0:t.code)==B.MessageHeaderResponseType.OK?(this.historyPatient=a,this.$emit("edited-patient",a),this.success=!0,this.editMode=!1):this.error=!0,this.updatingPatient=!1})).catch((e=>{this.error=!0,this.updatingPatient=!1,console.log("Error updating Patient "+this.givenNames[0]+" "+this.familyName,e)}))}else this.editMode=!0,this.success=!1},cancelEdit(){this.editMode=!1,this.fillDataFromPatient(this.historyPatient)},getGenderTranslation(e){let t=this.$props.translations.unknownGender;switch(e){case"male":t=this.$props.translations.maleGender;break;case"female":t=this.$props.translations.femaleGender;break;case"other":t=this.$props.translations.otherGender;break}return t},fillDataFromPatient(e){var t,a,l,i,n;const o=this.$store.getOids();this.givenNames=Z().evaluate(e,"Patient.name.first().given")||[],this.familyName=Z().evaluate(e,"Patient.name.first().family")[0]||"",this.gender=e.gender||B.PatientAdministrativeGender.UNKNOWN,this.birthdate=e.birthDate||"",this.addresses=e.address||[],this.eprSpid=(null===(a=null===(t=e.identifier)||void 0===t?void 0:t.find((e=>e.system===o.eprSpid)))||void 0===a?void 0:a.value)||"",this.mpiId=(null===(i=null===(l=e.identifier)||void 0===l?void 0:l.find((e=>e.system===o.mpiId)))||void 0===i?void 0:i.value)||"",this.localIds=(null===(n=e.identifier)||void 0===n?void 0:n.filter((e=>e.system===o.local)))||[],this.historyPatient=JSON.parse(JSON.stringify(e))},openDocument(e){const t=e.metadata;t.content&&t.content[0]&&t.content[0].attachment&&t.content[0].attachment.url?confirm(this.$props.translations.openPrompt1+(t.description||"?")+this.$props.translations.openPrompt2)&&window.open(t.content[0].attachment.url):console.log("Cann not open document in window, unsufficient metadata",document)},onUploaded(e){var t,a,l;this.showAddDocumentPopup=!1;const i=null===(t=e.entry)||void 0===t?void 0:t.find((e=>{var t,a;return null===(a=null===(t=e.response)||void 0===t?void 0:t.location)||void 0===a?void 0:a.includes("DocumentReference")}));if(i){const e=null===(l=null===(a=i.response)||void 0===a?void 0:a.location)||void 0===l?void 0:l.split("/")[1];e&&(0,A.kp)(e).then((e=>{this.uploadedDocuments.push(e),this.uploadSuccess=!0})).catch((e=>{console.log("couldnt fetch DocumentReference",e),this.uploadSuccess=!1}))}else this.uploadSuccess=!1;setTimeout((()=>{this.uploadSuccess=void 0}),1e3*nt)}},watch:{gender(e){switch(e){case"MALE":case"FEMALE":case"OTHER":case"UNKNOWN":this.gender=B.PatientAdministrativeGender[e]}}}});var st=a(9843),dt=a(926),rt=a(2074),ct=a(4458);const ut=(0,ie.Z)(ot,[["render",j],["__scopeId","data-v-53af8112"]]),pt=ut;ce()(ot,"components",{QPopupEdit:st.Z,QInput:se.Z,QSelect:tt.Z,QIcon:de.Z,QSeparator:dt.Z,QBtn:et.Z,QDialog:rt.Z,QCard:ct.Z});const mt={key:0},ht={class:"patient-search"},gt={class:"row"},ft={class:"col"},bt={class:"col"},yt={class:"row"},vt={class:"col"},wt={class:"col"},St={class:"row"},Lt={class:"col"},$t={class:"col local-system-label"},kt={key:0,class:"warning"};function Dt(e,t,a,n,o,s){const d=(0,l.up)("q-input"),r=(0,l.up)("q-select"),c=(0,l.up)("q-separator"),u=(0,l.up)("q-tooltip"),p=(0,l.up)("q-btn"),m=(0,l.up)("q-table");return e.translations?((0,l.wg)(),(0,l.iD)("div",mt,[(0,l._)("div",ht,[(0,l._)("form",null,[(0,l._)("div",gt,[(0,l._)("div",ft,[(0,l.Wm)(d,{modelValue:e.familyName,"onUpdate:modelValue":t[0]||(t[0]=t=>e.familyName=t),type:"text",label:e.translations.nameInputLabel},null,8,["modelValue","label"])]),(0,l._)("div",bt,[(0,l.Wm)(d,{modelValue:e.givenName,"onUpdate:modelValue":t[1]||(t[1]=t=>e.givenName=t),type:"text",label:e.translations.givenInputLabel},null,8,["modelValue","label"])])]),(0,l._)("div",yt,[(0,l._)("div",vt,[(0,l.Wm)(d,{modelValue:e.birthDate,"onUpdate:modelValue":t[2]||(t[2]=t=>e.birthDate=t),type:"date",class:"date-input","stack-label":"",label:e.translations.birthdayInputLabel},null,8,["modelValue","label"])]),(0,l._)("div",wt,[(0,l.Wm)(r,{modelValue:e.gender,"onUpdate:modelValue":t[3]||(t[3]=t=>e.gender=t),options:e.genderOptions,label:e.translations.genderInputLabel,"option-label":t=>{switch(t.toUpperCase()){case"MALE":return e.translations.genderMale;case"FEMALE":return e.translations.genderFemale;case"OTHER":return e.translations.genderOther;default:return"-"}}},null,8,["modelValue","options","label","option-label"])])]),(0,l.Wm)(c,{size:"0pt"}),(0,l._)("div",St,[(0,l._)("div",Lt,[(0,l.Wm)(d,{modelValue:e.localId,"onUpdate:modelValue":t[4]||(t[4]=t=>e.localId=t),type:"text",label:e.translations.idInputLabel},null,8,["modelValue","label"])]),(0,l._)("div",$t,[(0,l._)("p",null,"("+(0,i.zw)(e.translations.systemLabel+e.localIdSystem.display)+")",1)])]),(0,l.Wm)(c,{size:"0pt"}),(0,l.Wm)(p,{id:"search-button",onClick:e.search,type:"submit",label:e.translations.searchButtonLabel,disable:!e.enoughParameters||e.loading,loading:e.loading},{default:(0,l.w5)((()=>[e.enoughParameters?(0,l.kq)("",!0):((0,l.wg)(),(0,l.j4)(u,{key:0,class:"bg-warning"},{default:(0,l.w5)((()=>[(0,l.Uk)((0,i.zw)(e.translations.notEnoughParameter),1)])),_:1}))])),_:1},8,["onClick","label","disable","loading"])])]),e.notFound?((0,l.wg)(),(0,l.iD)("p",kt,(0,i.zw)(e.translations.noPatientFound),1)):(0,l.kq)("",!0),e.patients.length>0?((0,l.wg)(),(0,l.j4)(m,{key:1,title:e.translations.resultTableTitle,class:"result-table",dense:"","hide-bottom":"",rows:e.patients,pagination:{rowsPerPage:0},onRowClick:e.select,columns:e.tableColumns,"row-key":"eprSpid"},null,8,["title","rows","onRowClick","columns"])):(0,l.kq)("",!0)])):(0,l.kq)("",!0)}const Ct=(0,l.aZ)({name:"PatientSearch",data(){return{givenName:"",familyName:"",birthDate:"",localId:"",gender:B.PatientAdministrativeGender.UNKNOWN,genderOptions:new Array,patients:new Array,loading:!1,notFound:!1,tableColumns:[{name:"given",required:!0,label:this.$props.translations.givenInputLabel,align:"left",field:e=>Z().evaluate(e,"Patient.name.given")[0]},{name:"family",required:!0,label:this.$props.translations.nameInputLabel,align:"left",field:e=>Z().evaluate(e,"Patient.name.family")[0]},{name:"gender",required:!1,label:this.$props.translations.genderInputLabel,align:"left",field:e=>Z().evaluate(e,"Patient.gender")[0].substring(0,1)},{name:"birthdate",required:!0,label:this.$props.translations.birthdayInputLabel,align:"left",field:e=>new Date(Z().evaluate(e,"Patient.birthDate")[0]).toLocaleDateString()},{name:"place",required:!1,label:this.$props.translations.cityLabel,align:"left",field:e=>Z().evaluate(e,"Patient.address.city")[0]},{name:"eprSpid",required:!1,label:this.$props.translations.eprSpidLabel,align:"left",field:e=>{var t;const a=null===(t=e.identifier)||void 0===t?void 0:t.find((e=>e.system===this.$store.getOids().eprSpid));return a?a.value:""}},{name:"localID",required:!1,label:this.$props.translations.localPidLabel,align:"left",field:e=>{var t;const a=null===(t=e.identifier)||void 0===t?void 0:t.find((e=>e.system===this.$props.localIdSystem.urn));return a?a.value:""}}]}},props:{localIdSystem:{type:Object,required:!0},translations:{type:Object,required:!0},options:{type:Object,required:!1}},emits:{"found-patient":e=>void 0!==e},beforeMount(){for(var e in B.PatientAdministrativeGender)this.genderOptions.push(e)},methods:{search(e){e.preventDefault(),this.patients=[];const t={};this.givenName.length>0&&(t.given=this.givenName),this.familyName.length>0&&(t.family=this.familyName),this.birthDate.length>0&&(t.birthdate=this.birthDate),this.gender.toLocaleLowerCase()!=B.PatientAdministrativeGender.UNKNOWN&&(t.gender=this.gender),this.localId.length>0&&(t.identifier=this.$props.localIdSystem.urn+"|"+this.localId),this.loading=!0,(0,A.c2)(t).then((e=>{this.patients=e,this.notFound=0===e.length})).catch((e=>{this.patients=[],e.message.toLowerCase().indexOf("not found")?this.notFound=!0:console.log("Error:",e.message)})).finally((()=>{this.loading=!1}))},select(e,t){this.$emit("found-patient",t),this.$props.options&&this.$props.options.resetOnSelect&&(this.givenName="",this.familyName="",this.birthDate="",this.gender=B.PatientAdministrativeGender.UNKNOWN,this.localId="",this.patients=[])}},computed:{enoughParameters(){return""!==this.localId||""!==this.givenName&&""!==this.familyName||""!==this.givenName&&""!==this.birthDate||""!==this.familyName&&""!==this.birthDate}}});var _t=a(6858);const It=(0,ie.Z)(Ct,[["render",Dt],["__scopeId","data-v-3e959db8"]]),Vt=It;ce()(Ct,"components",{QInput:se.Z,QSelect:tt.Z,QSeparator:dt.Z,QBtn:et.Z,QTooltip:_t.Z,QTable:oe.Z});const qt=(0,l.aZ)({name:"Patients",components:{PatientView:pt,PatientSearch:Vt},data(){return{patient:{},localIdSystem:{urn:this.$store.getOids().local,display:"?"},patientSearchComponentTranslations:{},patientViewComponentTranslations:{},patientViewOptions:{showEditButton:!0,actionButtons:[{label:this.$t("patients.newSearch"),onClick:this.resetPatient}]}}},beforeMount(){this.patientViewComponentTranslations={nameInputLabel:this.$t("patients.nameLabel"),givenInputLabel:this.$t("patients.givenLabel"),genderLabel:this.$t("patients.genderLabel"),birthdateLabel:this.$t("patients.birthdateLabel"),addressLabel:this.$t("patients.addressLabel"),maleGender:this.$t("common.maleGender"),femaleGender:this.$t("common.femaleGender"),otherGender:this.$t("common.otherGender"),unknownGender:this.$t("common.unknownGender"),identifiersLabel:this.$t("patients.identifiersLabel"),localIdLabel:this.$t("patients.localIdLabel"),mpiIdLabel:this.$t("patients.mpiIdLabel"),eprSpidLabel:this.$t("patients.eprSpidLabel"),editButtonLabel:this.$t("patients.editButtonLabel"),cancelButtonLabel:this.$t("common.cancel"),saveButtonLabel:this.$t("common.save"),streetLabel:this.$t("patients.streetLabel"),zipLabel:this.$t("patients.zipLabel"),cityLabel:this.$t("patients.cityLabel"),uploadError:this.$t("common.error"),uploadSuccess:this.$t("patients.success"),openPrompt1:this.$t("patients.openPrompt1"),openPrompt2:this.$t("patients.openPrompt2"),addDocumentButton:this.$t("patients.addDocument"),uploadSuccessful:this.$t("documents.uploadSuccessful"),uploadUnsuccessful:this.$t("documents.uploadUnsuccessful"),documentSearchStrings:{titleLabel:this.$t("patients.documentTableLabel"),kiloByteLabel:this.$t("common.kiloByte"),megaByteLabel:this.$t("common.megaByte"),fetchMpiLabel:this.$t("patients.fetchMpi"),mpiLabel:this.$t("patients.fetchedMpi"),fetchMetadataLabel:this.$t("patients.fetchMetadata"),fetchingError:this.$t("patients.fetchingError"),searchLabel:this.$t("common.search"),dateLabel:this.$t("common.date"),descriptionLabel:this.$t("common.description"),classLabel:this.$t("common.class"),typeLabel:this.$t("common.type"),authorLabel:this.$t("common.author"),fileTypeLabel:this.$t("common.fileType"),fileSizeLabel:this.$t("common.fileSize")},documentUploadStrings:{titleLabel:this.$t("documents.titleLabel"),titleInputLabel:this.$t("documents.titleInput"),descriptionText:this.$t("documents.descriptionText"),descriptionInputLabel:this.$t("common.description"),uploadButtonLabel:this.$t("documents.uploadFile"),cancelButtonLabel:this.$t("common.cancel"),categoryLabel:this.$t("documents.fileTypeCategory"),typeLabel:this.$t("documents.fileType"),selectFile:this.$t("documents.selectFile"),selectFileText:this.$t("documents.selectFileText"),metadata:this.$t("documents.metadata"),metadataText:this.$t("documents.metadataText"),titleAndDescription:this.$t("documents.titleAndDescription"),languageText:this.$t("documents.languageText"),language:this.$t("common.language"),fileTypeText:this.$t("documents.fileTypeText"),typeNotSufficient:this.$t("documents.typeNotSufficient"),creatingInstitution:this.$t("documents.creatingInstitution"),creatingInstitutionText:this.$t("documents.creatingInstitutionText"),institution:this.$t("documents.institution"),specialisation:this.$t("documents.specialisation"),specialisationText:this.$t("documents.specialisationText"),jsonFhir:this.$t("documents.jsonFhir"),continue:this.$t("common.continue"),back:this.$t("common.back")}},this.patientSearchComponentTranslations={nameInputLabel:this.$t("common.familyName"),givenInputLabel:this.$t("common.givenName"),birthdayInputLabel:this.$t("common.birthdate"),genderInputLabel:this.$t("common.gender"),idInputLabel:this.$t("patients.localId"),systemLabel:this.$t("patients.system"),cityLabel:this.$t("patients.city"),eprSpidLabel:this.$t("common.eprSpid"),localPidLabel:this.$t("common.localPid"),searchButtonLabel:this.$t("common.search"),genderMale:this.$t("common.maleGender"),genderFemale:this.$t("common.femaleGender"),genderOther:this.$t("common.otherGender"),notEnoughParameter:this.$t("patients.missingParameter"),noPatientFound:this.$t("patients.notFound"),resultTableTitle:this.$t("patients.foundPatients")},this.localIdSystem.display=this.$store.getOrganizationResource().name||this.localIdSystem.display},methods:{onEdit(e){console.log("edited pat",e)},onFoundPatient(e){this.patient=e},resetPatient(){this.patient={}}}});var Pt=a(3190);const Ot=(0,ie.Z)(qt,[["render",n]]),Tt=Ot;ce()(qt,"components",{QCard:ct.Z,QCardSection:Pt.Z})}}]);